<link type="text/css" rel="stylesheet" href="../additional_files/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/sh_typical.min.css">
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$']], displayMath: [['$$', '$$']]}});</script>
<script type="text/javascript" src="../additional_files/MathJax-master/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<h3>题目描述</h3>
<p>有一天，由于某种穿越现象作用，你来到了传说中的小人国。</p>
<p>小人国的布局非常奇特，整个国家的交通系统可以被看成是一个 $2$ 行 $C$ 列的矩形网格，网格上的每个点代表一个城市，相邻的城市之间有一条道路，所以总共有 $2C$ 个城市和 $3C - 2$ 条道路。</p>
<p>小人国的交通状况非常槽糕。有的时候由于交通堵塞，两座城市之间的道路会变得不连通，直到拥堵解决，道路才会恢复畅通。</p>
<p><del>初来咋到的你决心毛遂自荐到交通部某份差事，部长听说你来自一个科技高度发达的世界，喜出望外地要求你编写一个查询应答系统，以挽救已经病入膏肓的小人国交通系统。</del></p>
<p>小人国的交通部将提供一些交通信息给你，你的任务是根据当前的交通情况回答查询的问题。交通信息可以分为以下几种格式：</p>
<ol>
<li><code>Close r<sub>1</sub> c<sub>1</sub> r<sub>2</sub> c<sub>2</sub></code>：<strong>相邻</strong>的两座城市 $(r_1, c_1)$ 和 $(r_2, c_2)$ 之间的道路被堵塞了；</li>
<li><code>Open r<sub>1</sub> c<sub>1</sub> r<sub>2</sub> c<sub>2</sub></code>：<strong>相邻</strong>的两座城市 $(r_1, c_1)$ 和 $(r_2, c_2)$ 之间的道路被疏通了；</li>
<li><code>Ask r<sub>1</sub> c<sub>1</sub> r<sub>2</sub> c<sub>2</sub></code>：询问城市 $(r_1, c_1)$ 和 $(r_2, c_2)$ 是否连通。如果存在一条路径使得这两条城市连通，则返回 <code>Y</code>，否则返回<code>N</code>。</li>
</ol>

<h3>输入格式</h3>
<p>第一行包含一个正整数 $C$ ($C \leq 10^5$)，表示网格的列数。</p>
<p>接下来若干行，每行为一条交通信息，以单独的一行 <code>Exit</code> 作为结束。我们假设在一开始所有的道路都是堵塞的。保证信息条数 $\leq 10^5$。</p>

<h3>输出格式</h3>
<p>对于每个查询，输出一行一个字符，为 <code>Y</code> 或 <code>N</code>。</p>

<h3>题解</h3>
<p>这道题其实是 "动态图连通性" 问题的一个简化版。</p>
<p>动态图连通性就是给一个图，支持加边、删边、询问连通性。强制在线的动态图连通性的算法并不简单，然而可离线的动态图连通性的算法和本题的算法是非常相近的，即运用线段树维护连通性。</p>
<p>我们把每个城市都看作是一个点，不同城市之间的道路看作一条边，那么整个小人国就呈现一个 $1 \times (C-1)$ 的网格。</p>
<p>我们用线段树节点 $[L, R]$ 记录第 $L$ 个交叉口和第 $R$ 个交叉口所组成的 $4$ 个节点<strong>在 $[L, R]$ 的导出子图中的两两连通性</strong>，如下图：</p>
<p><img src="uploads/8.bmp" alt="线段树维护连通性"></p>
<p>对于上图 $L = 2, R = 5$，节点 $[2, 5]$ 记录 LU, RU, LD, RD $4$ 个点在黑色的边 (当然有的边可能是不存在的) 之间的两两连通性。</p>
<p>特别地，如果 $L = R$，我们假定 LU 和 RU 重合，LD 和 RU 重合，此时如果那条竖着的边连通，$6$ 个 "节点对"全部连通，否则只有重合的 $2$ 个 "节点对" 连通。</p>
<p>然后考虑线段树的 <code>update()</code> 过程，假定两个子节点如下图所示：</p>
<p><img src="uploads/9.bmp" alt="线段树的 update() 过程"></p>
<p>注意中间两条蓝边是需要记录的，因为左右两棵子树都没有维护关于蓝边的信息。</p>
<p>对于新的 LU', RU', LD' 和 RD'，考虑 LU' 和 RU' 的连通性，那么只有两种情况，要么 <span style="color: blue">LU' 和左子树的 RU 连通、上面的蓝边存在、且右子树的 LU 和 RU' 连通</span>，要么为 <span style="color: blue">LU' 和左子树的 RD 连通、下面的蓝边存在、且右子树的 LD 和 RU' 连通</span>。</p>
<p>对于 LU' 和 RD'，LD' 和 RU'，LD' 和 RD'，都可以类似分析出来。</p>
<p>至于 LU' 和 LD'，由于是在<strong>导出子图</strong> (黑色部分) 的连通性，则它们要么<span style="color: blue">在左子树中就已经连通</span>，要么就是走一个 C 字形，即先 <span style="color: blue">LU' 与左子树的 RU 连通、两条蓝边都存在、右子树的 LU' 和 LD' 连通、且左子树的 RD 和 LD' 连通</span>。对于 RU' 和 RD'，则完全类似。</p>
<p>于是可以建立一个 <code>merge(x, y, mid)</code> 函数，传入左右子树的连通性和两条蓝边的存在情况，给出新的连通性。</p>
<p>接下来考虑修改 (加边/删边)，如果修改的是竖边，则只需单点修改即可。</p>
<p>如果修改的是横边，可以发现有部分节点需要更新，因此也可以直接调用单点 "修改" (其实只是为了后面 update 的 <code>merge()</code>)，不过要注意的是，横边需要另外开一个数组来记录。</p>
<p>考虑询问。在 $2 \times n$ <strong>格点</strong>图中，两点间的路径<strong>至多包含</strong>以下三个部分：左 C 形、中间部分、右 C 形，如下图所示：</p>
<p><img src="uploads/10.bmp" alt="2 × n 格点图中的一条路径"></p>
<p>我们枚举 "中间部分" (黄色部分) 的两个端点 (共 $4$ 种方案)，比如说从 LU 到 RU，那么，这种方案可行需要满足<span style="color: blue">中间部分的 LU 和 RU 连通、左边一列所需节点为 LU 或左边的 LU 和 LD 连通、右边一列所需节点为 RU 或右边的 RU 和 RD 连通</span>。</p>
<p>注意，由于左/右 C 形的存在，此处左边的 LU 和 LD 连通<strong>不能仅仅在中间部分的导出子图中，应该是整个图的连通</strong>，因此需要调用三次线段树的 <code>range()</code>，即 $1 \sim c_1, c_1 \sim c_2, c_2 \sim C$，这里假定 $c_1 \leq c_2$。</p>
<p>最后，如果这 $4$ 种方案只要有一种行得通，则答案就是 <code>Y</code>，否则为 <code>N</code>，时间复杂度为 $O(n \log C)$，其中 $n$ 为操作个数。不过，因为线段树内部只存储了 $6$ 个布尔 (连通性)，所以可以压缩到一个 <code>char</code> 中，通过位运算来避免高维数组和 <code>struct</code>。</p>

<h3>代码</h3>

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> N <span class="sh_number">426835</span>
<span class="sh_preproc">#define</span> segc <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> rc <span class="sh_symbol">=</span> lc <span class="sh_symbol">|</span> <span class="sh_number">1</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_comment">// uu(1) ud(2) du(4) dd(8) l(16) r(32) or u(1) d(2)</span>
<span class="sh_keyword">typedef</span> <span class="sh_type">char</span> state<span class="sh_symbol">;</span>

<span class="sh_type">int</span> n<span class="sh_symbol">,</span> r1<span class="sh_symbol">,</span> r2<span class="sh_symbol">,</span> c1<span class="sh_symbol">,</span> c2<span class="sh_symbol">;</span>

<span class="sh_type">char</span> cmd<span class="sh_symbol">[</span><span class="sh_number">10</span><span class="sh_symbol">];</span>

<span class="sh_usertype">state</span><span class="sh_normal"> </span>ho<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> st<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>

<span class="sh_keyword">inline</span> <span class="sh_usertype">state</span><span class="sh_normal"> </span><span class="sh_function">merge</span><span class="sh_symbol">(</span><span class="sh_usertype">state</span><span class="sh_normal"> </span>x<span class="sh_symbol">,</span> <span class="sh_usertype">state</span><span class="sh_normal"> </span>y<span class="sh_symbol">,</span> <span class="sh_usertype">state</span><span class="sh_normal"> </span>mid<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_usertype">state</span><span class="sh_normal"> </span>res <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> mid <span class="sh_symbol">|=</span> mid<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">2</span> <span class="sh_symbol">|</span> mid<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">4</span><span class="sh_symbol">;</span>
    res <span class="sh_symbol">|=</span> <span class="sh_symbol">(</span>x    <span class="sh_symbol">&amp;</span> mid    <span class="sh_symbol">&amp;</span> y    <span class="sh_symbol">|</span> x<span class="sh_symbol">&gt;&gt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> mid<span class="sh_symbol">&gt;&gt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> y<span class="sh_symbol">&gt;&gt;</span><span class="sh_number">2</span><span class="sh_symbol">)</span> <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    res <span class="sh_symbol">|=</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> mid<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> y    <span class="sh_symbol">|</span> x    <span class="sh_symbol">&amp;</span> mid    <span class="sh_symbol">&amp;</span> y<span class="sh_symbol">&gt;&gt;</span><span class="sh_number">2</span><span class="sh_symbol">)</span> <span class="sh_symbol">&amp;</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
    res <span class="sh_symbol">|=</span> <span class="sh_symbol">(</span>x    <span class="sh_symbol">&amp;</span> mid    <span class="sh_symbol">&amp;</span> y<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">2</span> <span class="sh_symbol">|</span> x<span class="sh_symbol">&gt;&gt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> mid<span class="sh_symbol">&gt;&gt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> y   <span class="sh_symbol">)</span> <span class="sh_symbol">&amp;</span> <span class="sh_number">4</span><span class="sh_symbol">;</span>
    res <span class="sh_symbol">|=</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> mid<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> y<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">2</span> <span class="sh_symbol">|</span> x    <span class="sh_symbol">&amp;</span> mid    <span class="sh_symbol">&amp;</span> y   <span class="sh_symbol">)</span> <span class="sh_symbol">&amp;</span> <span class="sh_number">8</span><span class="sh_symbol">;</span>
    res <span class="sh_symbol">|=</span> <span class="sh_symbol">((</span>x<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">4</span> <span class="sh_symbol">&amp;</span> mid    <span class="sh_symbol">&amp;</span> y  <span class="sh_symbol">&amp;</span> mid<span class="sh_symbol">&gt;&gt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> x<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">|</span> x<span class="sh_symbol">)</span> <span class="sh_symbol">&amp;</span> <span class="sh_number">16</span><span class="sh_symbol">;</span>
    res <span class="sh_symbol">|=</span> <span class="sh_symbol">((</span>y<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">5</span> <span class="sh_symbol">&amp;</span> mid<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;</span> x  <span class="sh_symbol">&amp;</span> mid    <span class="sh_symbol">&amp;</span> y<span class="sh_symbol">&lt;&lt;</span><span class="sh_number">2</span><span class="sh_symbol">)</span> <span class="sh_symbol">|</span> y<span class="sh_symbol">)</span> <span class="sh_symbol">&amp;</span> <span class="sh_number">32</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> res<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">build</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>st<span class="sh_symbol">[</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">9</span><span class="sh_symbol">;</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    segc<span class="sh_symbol">;</span> <span class="sh_function">build</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">);</span> <span class="sh_function">build</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">);</span>
    st<span class="sh_symbol">[</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_usertype">state</span><span class="sh_normal"> </span>v <span class="sh_symbol">=</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_symbol">~</span>v <span class="sh_symbol">?</span> <span class="sh_symbol">(</span>st<span class="sh_symbol">[</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> v <span class="sh_symbol">?</span> <span class="sh_number">63</span> <span class="sh_symbol">:</span> <span class="sh_number">9</span><span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    segc<span class="sh_symbol">;</span> h <span class="sh_symbol">&lt;=</span> M <span class="sh_symbol">?</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
    st<span class="sh_symbol">[</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">merge</span><span class="sh_symbol">(</span>st<span class="sh_symbol">[</span>lc<span class="sh_symbol">],</span> st<span class="sh_symbol">[</span>rc<span class="sh_symbol">],</span> ho<span class="sh_symbol">[</span>M<span class="sh_symbol">]);</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">state</span><span class="sh_normal"> </span><span class="sh_function">range</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> ql<span class="sh_symbol">,</span> <span class="sh_type">int</span> qr<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> L <span class="sh_symbol">&amp;&amp;</span> R <span class="sh_symbol">&lt;=</span> qr<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> st<span class="sh_symbol">[</span>id<span class="sh_symbol">];</span>
    segc<span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>qr <span class="sh_symbol">&lt;=</span> M<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_function">range</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> ql<span class="sh_symbol">,</span> qr<span class="sh_symbol">);</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&gt;</span> M<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_function">range</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> ql<span class="sh_symbol">,</span> qr<span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> <span class="sh_function">merge</span><span class="sh_symbol">(</span><span class="sh_function">range</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> ql<span class="sh_symbol">,</span> M<span class="sh_symbol">),</span> <span class="sh_function">range</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> qr<span class="sh_symbol">),</span> ho<span class="sh_symbol">[</span>M<span class="sh_symbol">]);</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n<span class="sh_symbol">);</span>
    <span class="sh_function">build</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%s"</span><span class="sh_symbol">,</span> cmd<span class="sh_symbol">);</span> <span class="sh_symbol">*</span>cmd <span class="sh_symbol">!=</span> <span class="sh_number">69</span><span class="sh_symbol">;</span> <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%s"</span><span class="sh_symbol">,</span> cmd<span class="sh_symbol">))</span>
        <span class="sh_keyword">switch</span><span class="sh_symbol">(</span><span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>r1<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>c1<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>r2<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>c2<span class="sh_symbol">),</span> <span class="sh_symbol">*</span>cmd<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">case</span> <span class="sh_number">79</span><span class="sh_symbol">:</span> <span class="sh_cbracket">{</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>c1 <span class="sh_symbol">==</span> c2<span class="sh_symbol">)</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> c1<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span> <span class="sh_comment">// single column</span>
                <span class="sh_keyword">else</span> <span class="sh_cbracket">{</span>ho<span class="sh_symbol">[</span>c1 <span class="sh_symbol">&gt;</span> c2 <span class="sh_symbol">?</span> <span class="sh_symbol">--</span>c1 <span class="sh_symbol">:</span> c1<span class="sh_symbol">]</span> <span class="sh_symbol">|=</span> r1<span class="sh_symbol">;</span>  <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> c1<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
                <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
            <span class="sh_cbracket">}</span>
            <span class="sh_keyword">case</span> <span class="sh_number">67</span><span class="sh_symbol">:</span> <span class="sh_cbracket">{</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>c1 <span class="sh_symbol">==</span> c2<span class="sh_symbol">)</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> c1<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span> <span class="sh_comment">// single column</span>
                <span class="sh_keyword">else</span> <span class="sh_cbracket">{</span>ho<span class="sh_symbol">[</span>c1 <span class="sh_symbol">&gt;</span> c2 <span class="sh_symbol">?</span> <span class="sh_symbol">--</span>c1 <span class="sh_symbol">:</span> c1<span class="sh_symbol">]</span> <span class="sh_symbol">&amp;=</span> <span class="sh_symbol">~</span>r1<span class="sh_symbol">;</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> c1<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
                <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
            <span class="sh_cbracket">}</span>
            <span class="sh_keyword">case</span> <span class="sh_number">65</span><span class="sh_symbol">:</span> <span class="sh_cbracket">{</span>
                <span class="sh_usertype">state</span><span class="sh_normal"> </span>p<span class="sh_symbol">,</span> q<span class="sh_symbol">,</span> r<span class="sh_symbol">;</span> <span class="sh_type">bool</span> succeed <span class="sh_symbol">=</span> <span class="sh_keyword">false</span><span class="sh_symbol">;</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>c1 <span class="sh_symbol">&gt;</span> c2<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">swap</span><span class="sh_symbol">(</span>r1<span class="sh_symbol">,</span> r2<span class="sh_symbol">);</span> <span class="sh_function">swap</span><span class="sh_symbol">(</span>c1<span class="sh_symbol">,</span> c2<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
                p <span class="sh_symbol">=</span> <span class="sh_function">range</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> c1<span class="sh_symbol">);</span>
                q <span class="sh_symbol">=</span> <span class="sh_function">range</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> c1<span class="sh_symbol">,</span> c2<span class="sh_symbol">);</span>
                r <span class="sh_symbol">=</span> <span class="sh_function">range</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> c2<span class="sh_symbol">,</span> n<span class="sh_symbol">);</span>
                p <span class="sh_symbol">&amp;</span> <span class="sh_number">32</span> <span class="sh_symbol">?</span> q <span class="sh_symbol">|=</span> <span class="sh_number">16</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> r <span class="sh_symbol">&amp;</span> <span class="sh_number">16</span> <span class="sh_symbol">?</span> q <span class="sh_symbol">|=</span> <span class="sh_number">32</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
                q <span class="sh_symbol">&amp;</span> <span class="sh_number">16</span> <span class="sh_symbol">?</span> r1 <span class="sh_symbol">=</span> <span class="sh_number">3</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> q <span class="sh_symbol">&amp;</span> <span class="sh_number">32</span> <span class="sh_symbol">?</span> r2 <span class="sh_symbol">=</span> <span class="sh_number">3</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
                succeed <span class="sh_symbol">|=</span> q <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">&amp;&amp;</span> r1 <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">&amp;&amp;</span> r2 <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
                succeed <span class="sh_symbol">|=</span> q <span class="sh_symbol">&amp;</span> <span class="sh_number">2</span> <span class="sh_symbol">&amp;&amp;</span> r1 <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">&amp;&amp;</span> r2 <span class="sh_symbol">&amp;</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
                succeed <span class="sh_symbol">|=</span> q <span class="sh_symbol">&amp;</span> <span class="sh_number">4</span> <span class="sh_symbol">&amp;&amp;</span> r1 <span class="sh_symbol">&amp;</span> <span class="sh_number">2</span> <span class="sh_symbol">&amp;&amp;</span> r2 <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
                succeed <span class="sh_symbol">|=</span> q <span class="sh_symbol">&amp;</span> <span class="sh_number">8</span> <span class="sh_symbol">&amp;&amp;</span> r1 <span class="sh_symbol">&amp;</span> <span class="sh_number">2</span> <span class="sh_symbol">&amp;&amp;</span> r2 <span class="sh_symbol">&amp;</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
                <span class="sh_function">putchar</span><span class="sh_symbol">(</span>succeed <span class="sh_symbol">?</span> <span class="sh_number">89</span> <span class="sh_symbol">:</span> <span class="sh_number">78</span><span class="sh_symbol">);</span> <span class="sh_function">putchar</span><span class="sh_symbol">(</span><span class="sh_number">10</span><span class="sh_symbol">);</span>
                <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
            <span class="sh_cbracket">}</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h3>坑</h3>
<p><strong>坑1：</strong>在压缩后的位运算中，需要仔细运算，不要出现移位多/少了的这种情况，还有最后的 <code>&amp;</code> 和 <code>&amp;&amp;</code> 分清楚。</p>
<p><strong>坑2：</strong>在判断 LU' 和 LD' (RU' 和 RD') 的连通性时，不要忘记在 "对应子树就已经连通" 的情况，即最后做一次 <code>|</code> 运算。</p>
