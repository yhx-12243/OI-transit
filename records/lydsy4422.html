<link type="text/css" rel="stylesheet" href="../additional_files/css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/css/sh_typical.min.css">
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$']], displayMath: [['$$', '$$']]}});</script>
<script type="text/javascript" src="../additional_files/MathJax-master/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<style type="text/css">
span.very-strong, span.very-strong .sh_symbol, span.very-strong .sh_comment {font-weight: 900; font-size: 1.2em}
</style>

<h3>题目描述</h3>
<p>一个 $10^6$ 行 $10^6$ 列的网格图，上面有一些牛、花和一些矩形围栏。围栏在格子的边界上，且不会相交；牛和花在格子里，牛只能向下或向右走，牛也不能穿过围栏和地图边界，求每头牛它能到达的花的数量。</p>
<img class="center-block" src="http://www.lydsy.com/JudgeOnline/upload/201603/aa.png" alt="例子">

<h3>输入格式</h3>
<p>第一行包含一个整数 $f$ ($f \leq 2 \times 10^5$) 表示矩形围栏的数量。</p>
<p>接下来的 $f$ 行，每行包含四个整数 $x_1, y_1, x_2, y_2$，表示 $(x_1, y_1)$ 在围栏内部矩形的左上角，$(x_2, y_2)$ 在右下角。</p>
<p>接下来一行包含一个整数 $m$ ($m \leq 2 \times 10^5$) 表示花的数量。</p>
<p>接下来的 $m$ 行，每行包含两个整数 $x, y$，表示在 $(x, y)$ 处有一朵花。</p>
<p>接下来一行包含一个正整数 $n$ ($n \leq 2 \times 10^5$) 表示牛的数量。</p>
<p>接下来的 $n$ 行，每行包含两个整数 $x, y$，表示在 $(x, y)$ 处有一头牛。</p>

<h3>输出格式</h3>
<p>总共 $n$ 行，每行一个数 $ans$，第 $i$ 个数表示第 $i$ 头牛能到 $ans$ 个花。

<h3>题解</h3>
<p>显然这题可以用 DP 实现。</p>
<p>利用<del>简单地</del>差分思想，记 $f_{i, j}$ 表示第 $j$ 列中，第 $i$ 行的格子 $(i, j)$ 可以到达，<strong>而第 $i+1$ 行的格子 $(i+1, j)$ (如果存在) 不能到达</strong>的花数。</p>
<p>那么对于一头牛 $(i, j)$，记它下面遇到的横向栅栏边上方的格子 (以下简称 <span style="color: red">"下面的栅栏"</span>) 为 $(t, j)$，则答案就是 $\sum\limits_{k=i}^t f_{k, j}$。</p>
<p>考虑转移，显然是 $j$ 从大到小转移 ($i$ 从大到小亦可)，可以发现，$f_{i, j}$ 与 $f_{i, j+1}$ <strong>大致</strong>是相同的，所以直接拷贝过来，就这些地方需要变化：</p>
<ol>
<li>$(i, j)$ 处有一朵花。由于 $f_{i, j}$ 维护的是 $(i, j)$ 能到，$(i+1, j)$ 不能到的花数，故有 $$ f_{i, j} = f_{i, j+1} + 1 $$</li>
<li>$(i, j)$ 处是一头牛。牛刚才已经说了，如果下面的栅栏为 $(t, j)$ 则答案为 $$ \sum_{k=i}^t f_{k, j} $$</li>
<li>$(i, j)$ 处遇到栅栏。栅栏这种说法太笼统了，我们可以像计算几何的扫描线一样，把一个栅栏 (一个框) 拆分成两个线段，暂且将右边的一个记作开线段，记为 $(r_1, r_2, j)$，左边的一个记作闭线段，记为 $[r_1, r_2, c]$，如样例右上角的栅栏，它的开线段为 $(1, 5, 10)$，闭线段为 $[1, 5, 8]$。</li>
<li>如果 $(i, j)$ 处是个开线段 $(r_1, r_2, j)$，则首先显然要把区间 $[r_1, r_2)$ 中的值清空，即 $$ f_{i, j} = 0 \quad (r_1 \leq i &lt; r_2) $$</li>
<p>此时，由于刚才的清空，考虑 $(r_1-1, j)$ 位置 (如果存在)，记 $(r_2, j)$ 下面的栅栏为 $(t, j)$，则 $f_{r_1-1, j}$ 需要加上第 $j+1$ 列从 $r_1$ 到 $t$ 可到达的花的数量的总和，即</p>
<p>$$ f_{r_1 - 1, j} = \sum_{i=r_1}^t f_{i, j+1} $$</p>
<p style="color: red">ps: 此时需要记录一下 $\sum\limits_{i=r_2+1}^t f_{i, j+1}$ 的值，因为以后要用到。</p>
<li>如果 $(i, j)$ 处是个闭线段 $[r_1, r_2, j]$，则首先还是要把区间 $[r_1, r_2)$ 中的值清空，即 $$ f_{i, j} = 0 \quad (r_1 \leq i &lt; r_2) $$</li>
<p>由于这个清空，又要考虑这个 $(r_1-1, j)$ 位置。记它<strong>对应的栅栏</strong>的开线段为 $(r_1, r_2, j')$，$(r_2, j')$ 下方的栅栏为 $(t', j')$。</p>
<p>考虑 $(r_2+1, j'+1)$ 到 $(t', j'+1)$ 一段格子，它存储在 $f_{r_1-1, j}$ 中，然而它现在已经可以被 $(r_1, j)$ 访问到，因此<strong>需要将 $f_{r_1-1, j}$ 的值减去那些值</strong>，即</p>
<p>$$ f_{r_1-1, j} \downarrow \sum\limits_{i=r_1}^{t'} f_{i, j'+1} $$</p>
<p>其中 $a \downarrow b$ 代表 <code>a -= b</code>，这就是刚才提到记录这个值的原因。</p>
</ol>
<p>这样就是一个 $O(W^2)$ 的复杂度，其中 $W$ 为方格表的宽度或高度，即 $W \leq 10^6$，而这个显然是不行的。</p>
<p>看一下 DP 方程，可以得到，这个 DP 主要是基于<strong>单点修改、区间求和和区间置零</strong>的，因此可以考虑用<strong>线段树优化</strong> DP，顺便把空间的 $j$ 一维优化掉。总时间复杂度 $O(W \log W)$。</p>

<h3>代码</h3>

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> N <span class="sh_number">1024404</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">seg</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> l<span class="sh_symbol">,</span> r<span class="sh_symbol">,</span> col<span class="sh_symbol">,</span> d<span class="sh_symbol">;</span>
    <span class="sh_function">seg</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> l0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> r0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> column <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> data <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">):</span> <span class="sh_function">l</span><span class="sh_symbol">(</span>l0<span class="sh_symbol">),</span> <span class="sh_function">r</span><span class="sh_symbol">(</span>r0<span class="sh_symbol">),</span> <span class="sh_function">col</span><span class="sh_symbol">(</span>column<span class="sh_symbol">),</span> <span class="sh_function">d</span><span class="sh_symbol">(</span>data<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">pr</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> r<span class="sh_symbol">,</span> c<span class="sh_symbol">,</span> id<span class="sh_symbol">;</span>
    <span class="sh_function">pr</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> r0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> c0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> id0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">):</span> <span class="sh_function">r</span><span class="sh_symbol">(</span>r0<span class="sh_symbol">),</span> <span class="sh_function">c</span><span class="sh_symbol">(</span>c0<span class="sh_symbol">),</span> <span class="sh_function">id</span><span class="sh_symbol">(</span>id0<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
    pr <span class="sh_symbol">*</span> <span class="sh_function">read</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>r<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>c<span class="sh_symbol">);</span> id <span class="sh_symbol">=</span> id0<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> <span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">pr</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_keyword">const</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> c <span class="sh_symbol">&gt;</span> b<span class="sh_symbol">.</span>c<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">ST</span><span class="sh_cbracket">{</span>
<span class="sh_preproc">    #define</span> segc <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> rc <span class="sh_symbol">=</span> lc <span class="sh_symbol">|</span> <span class="sh_number">1</span>
    <span class="sh_type">int</span> sz<span class="sh_symbol">;</span>
    <span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">node</span> <span class="sh_cbracket">{</span><span class="sh_type">int</span> v<span class="sh_symbol">,</span> f<span class="sh_symbol">;</span> <span class="sh_type">bool</span> zero<span class="sh_symbol">;</span><span class="sh_cbracket">}</span> <span class="sh_symbol">*</span>x<span class="sh_symbol">;</span>
    <span class="sh_function">ST</span> <span class="sh_symbol">():</span> <span class="sh_function">sz</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>x <span class="sh_symbol">=</span> NULL<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_symbol">~</span><span class="sh_function">ST</span> <span class="sh_symbol">()</span> <span class="sh_cbracket">{</span><span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">resize</span><span class="sh_symbol">(</span><span class="sh_type">int</span> size<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>sz <span class="sh_symbol">=</span> size<span class="sh_symbol">;</span> <span class="sh_type">int</span> sz0 <span class="sh_symbol">=</span> sz <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">3</span><span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">);</span>
        x <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> node<span class="sh_symbol">[</span>sz0<span class="sh_symbol">];</span> <span class="sh_function">memset</span><span class="sh_symbol">(</span>x<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> sz0 <span class="sh_symbol">*</span> <span class="sh_keyword">sizeof</span><span class="sh_symbol">(</span>node<span class="sh_symbol">));</span><span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">add</span><span class="sh_symbol">(</span><span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">add</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">cut</span><span class="sh_symbol">(</span><span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">cut</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">zeroize</span><span class="sh_symbol">(</span><span class="sh_type">int</span> l<span class="sh_symbol">,</span> <span class="sh_type">int</span> r<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">zeroize</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> r<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">int</span> <span class="sh_function">range</span><span class="sh_symbol">(</span><span class="sh_type">int</span> l<span class="sh_symbol">,</span> <span class="sh_type">int</span> r<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">query</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> r<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">int</span> <span class="sh_function">upper</span><span class="sh_symbol">(</span><span class="sh_type">int</span> h<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">upper</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> h<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">push_down</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> lc<span class="sh_symbol">,</span> <span class="sh_type">int</span> rc<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>v <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>v <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>zero <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>zero <span class="sh_symbol">=</span> <span class="sh_keyword">true</span><span class="sh_symbol">;</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>zero <span class="sh_symbol">=</span> <span class="sh_keyword">false</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">add</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_type">void</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>v <span class="sh_symbol">+=</span> v<span class="sh_symbol">);</span>
        segc<span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>zero<span class="sh_symbol">)</span> <span class="sh_function">push_down</span><span class="sh_symbol">(</span>id<span class="sh_symbol">,</span> lc<span class="sh_symbol">,</span> rc<span class="sh_symbol">);</span>
        h <span class="sh_symbol">&lt;=</span> M <span class="sh_symbol">?</span> <span class="sh_function">add</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">add</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
        x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>v <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>v <span class="sh_symbol">+</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>v<span class="sh_symbol">;</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>f <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>f <span class="sh_symbol">|</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>f<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">cut</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_type">void</span><span class="sh_symbol">((</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>f <span class="sh_symbol">&amp;=</span> <span class="sh_symbol">-</span><span class="sh_number">2</span><span class="sh_symbol">)</span> <span class="sh_symbol">|=</span> v<span class="sh_symbol">);</span>
        segc<span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>zero<span class="sh_symbol">)</span> <span class="sh_function">push_down</span><span class="sh_symbol">(</span>id<span class="sh_symbol">,</span> lc<span class="sh_symbol">,</span> rc<span class="sh_symbol">);</span>
        h <span class="sh_symbol">&lt;=</span> M <span class="sh_symbol">?</span> <span class="sh_function">cut</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">cut</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
        x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>v <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>v <span class="sh_symbol">+</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>v<span class="sh_symbol">;</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>f <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>f <span class="sh_symbol">|</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>f<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">zeroize</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> ql<span class="sh_symbol">,</span> <span class="sh_type">int</span> qr<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> L <span class="sh_symbol">&amp;&amp;</span> R <span class="sh_symbol">&lt;=</span> qr<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>v <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>zero <span class="sh_symbol">=</span> <span class="sh_keyword">true</span><span class="sh_symbol">;</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>zero<span class="sh_symbol">)</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span> segc<span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> M<span class="sh_symbol">)</span> <span class="sh_function">zeroize</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> ql<span class="sh_symbol">,</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>qr<span class="sh_symbol">,</span> M<span class="sh_symbol">));</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>qr <span class="sh_symbol">&gt;</span> M<span class="sh_symbol">)</span> <span class="sh_function">zeroize</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>ql<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">),</span> qr<span class="sh_symbol">);</span>
        x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>v <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>v <span class="sh_symbol">+</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>v<span class="sh_symbol">;</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>f <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>f <span class="sh_symbol">|</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>f<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">int</span> <span class="sh_function">query</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> ql<span class="sh_symbol">,</span> <span class="sh_type">int</span> qr<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> L <span class="sh_symbol">&amp;&amp;</span> R <span class="sh_symbol">&lt;=</span> qr<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>v<span class="sh_symbol">;</span>
        segc<span class="sh_symbol">,</span> s <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>zero<span class="sh_symbol">)</span> <span class="sh_function">push_down</span><span class="sh_symbol">(</span>id<span class="sh_symbol">,</span> lc<span class="sh_symbol">,</span> rc<span class="sh_symbol">);</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> M<span class="sh_symbol">)</span> s <span class="sh_symbol">+=</span> <span class="sh_function">query</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> ql<span class="sh_symbol">,</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>qr<span class="sh_symbol">,</span> M<span class="sh_symbol">));</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>qr <span class="sh_symbol">&gt;</span> M<span class="sh_symbol">)</span> s <span class="sh_symbol">+=</span> <span class="sh_function">query</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>ql<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">),</span> qr<span class="sh_symbol">);</span>
        <span class="sh_keyword">return</span> s<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">int</span> <span class="sh_function">Urange</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> L<span class="sh_symbol">;</span>
        segc<span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>zero<span class="sh_symbol">)</span> <span class="sh_function">push_down</span><span class="sh_symbol">(</span>id<span class="sh_symbol">,</span> lc<span class="sh_symbol">,</span> rc<span class="sh_symbol">);</span>
        <span class="sh_keyword">return</span> x<span class="sh_symbol">[</span>lc<span class="sh_symbol">].</span>f <span class="sh_symbol">?</span> <span class="sh_function">Urange</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">Urange</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">int</span> <span class="sh_function">upper</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> h<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">;</span>
        segc<span class="sh_symbol">,</span> r<span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>zero<span class="sh_symbol">)</span> <span class="sh_function">push_down</span><span class="sh_symbol">(</span>id<span class="sh_symbol">,</span> lc<span class="sh_symbol">,</span> rc<span class="sh_symbol">);</span>
        r <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>h <span class="sh_symbol">&gt;</span> M <span class="sh_symbol">?</span> <span class="sh_function">upper</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> h<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">upper</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> h<span class="sh_symbol">));</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(~</span>r<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> r<span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>h <span class="sh_symbol">&lt;=</span> M <span class="sh_symbol">&amp;&amp;</span> x<span class="sh_symbol">[</span>rc<span class="sh_symbol">].</span>f<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_function">Urange</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">);</span>
        <span class="sh_keyword">return</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_keyword">const</span> <span class="sh_type">int</span> n <span class="sh_symbol">=</span> <span class="sh_number">1000000</span><span class="sh_symbol">;</span>

<span class="sh_type">int</span> n_fence<span class="sh_symbol">,</span> n_flower<span class="sh_symbol">,</span> n_cow<span class="sh_symbol">;</span>
<span class="sh_type">int</span> i_fence<span class="sh_symbol">,</span> i_flower<span class="sh_symbol">,</span> i_cow<span class="sh_symbol">;</span>
<span class="sh_type">int</span> Left<span class="sh_symbol">,</span> Top<span class="sh_symbol">,</span> Right<span class="sh_symbol">,</span> Bottom<span class="sh_symbol">;</span>
<span class="sh_type">int</span> sc<span class="sh_symbol">,</span> ne<span class="sh_symbol">,</span> su<span class="sh_symbol">,</span> tu<span class="sh_symbol">;</span>
<span class="sh_type">int</span> ans<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> order<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
<span class="sh_usertype">seg</span><span class="sh_normal"> </span>fence<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">],</span> F<span class="sh_symbol">;</span>
<span class="sh_usertype">pr</span><span class="sh_normal"> </span>flower<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> cow<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
<span class="sh_usertype">ST</span><span class="sh_normal"> </span>s<span class="sh_symbol">;</span>

<span class="sh_type">bool</span> <span class="sh_function">cmp</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>a<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> fence<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>col <span class="sh_symbol">&gt;</span> fence<span class="sh_symbol">[</span>b<span class="sh_symbol">].</span>col <span class="very-strong"><span class="sh_symbol">||</span> fence<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>col <span class="sh_symbol">==</span> fence<span class="sh_symbol">[</span>b<span class="sh_symbol">].</span>col <span class="sh_symbol">&amp;&amp;</span> fence<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>l <span class="sh_symbol">&lt;</span> fence<span class="sh_symbol">[</span>b<span class="sh_symbol">].</span>l<span class="sh_symbol">;</span><span class="sh_cbracket">}</span> <span class="sh_comment">// too important !!!</span></span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n_fence<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i_fence <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i_fence <span class="sh_symbol">&lt;</span> n_fence<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i_fence<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>Top<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>Left<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>Bottom<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>Right<span class="sh_symbol">);</span>
        fence<span class="sh_symbol">[</span>i_fence <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">seg</span><span class="sh_symbol">(</span>Top<span class="sh_symbol">,</span> Bottom<span class="sh_symbol">,</span> Right<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
        fence<span class="sh_symbol">[</span>i_fence <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span> <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">seg</span><span class="sh_symbol">(</span>Top<span class="sh_symbol">,</span> Bottom<span class="sh_symbol">,</span> Left <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>n_fence <span class="sh_symbol">&lt;&lt;=</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> i_fence <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i_fence <span class="sh_symbol">&lt;</span> n_fence<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i_fence<span class="sh_symbol">)</span> order<span class="sh_symbol">[</span>i_fence<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> i_fence<span class="sh_symbol">;</span>
    <span class="sh_function">sort</span><span class="sh_symbol">(</span>order<span class="sh_symbol">,</span> order <span class="sh_symbol">+</span> n_fence<span class="sh_symbol">,</span> cmp<span class="sh_symbol">);</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n_flower<span class="sh_symbol">);</span> <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i_flower <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i_flower <span class="sh_symbol">&lt;</span> n_flower<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i_flower<span class="sh_symbol">)</span> flower<span class="sh_symbol">[</span>i_flower<span class="sh_symbol">].</span><span class="sh_function">read</span><span class="sh_symbol">();</span>
    <span class="sh_function">sort</span><span class="sh_symbol">(</span>flower<span class="sh_symbol">,</span> flower <span class="sh_symbol">+</span> n_flower<span class="sh_symbol">);</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n_cow<span class="sh_symbol">);</span> <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i_cow <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i_cow <span class="sh_symbol">&lt;</span> n_cow<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i_cow<span class="sh_symbol">)</span> cow<span class="sh_symbol">[</span>i_cow<span class="sh_symbol">].</span><span class="sh_function">read</span><span class="sh_symbol">(</span>i_cow<span class="sh_symbol">);</span>
    <span class="sh_function">sort</span><span class="sh_symbol">(</span>cow<span class="sh_symbol">,</span> cow <span class="sh_symbol">+</span> n_cow<span class="sh_symbol">);</span>
    i_fence <span class="sh_symbol">=</span> i_flower <span class="sh_symbol">=</span> i_cow <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    s<span class="sh_symbol">.</span><span class="sh_function">resize</span><span class="sh_symbol">(</span>n <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">);</span> s<span class="sh_symbol">.</span><span class="sh_function">cut</span><span class="sh_symbol">(</span>n <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">2</span><span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>sc <span class="sh_symbol">=</span> n<span class="sh_symbol">;</span> sc<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>sc<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>F <span class="sh_symbol">=</span> fence<span class="sh_symbol">[</span>order<span class="sh_symbol">[</span>i_fence<span class="sh_symbol">]];</span> i_fence <span class="sh_symbol">&lt;</span> n_fence <span class="sh_symbol">&amp;&amp;</span> F<span class="sh_symbol">.</span>col <span class="sh_symbol">==</span> sc<span class="sh_symbol">;</span> F <span class="sh_symbol">=</span> fence<span class="sh_symbol">[</span>order<span class="sh_symbol">[++</span>i_fence<span class="sh_symbol">]])</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>d <span class="sh_symbol">==</span> <span class="sh_number">1</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span> <span class="sh_comment">// appear</span>
                ne <span class="sh_symbol">=</span> s<span class="sh_symbol">.</span><span class="sh_function">upper</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>r<span class="sh_symbol">);</span>
                su <span class="sh_symbol">=</span> s<span class="sh_symbol">.</span><span class="sh_function">range</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l<span class="sh_symbol">,</span> F<span class="sh_symbol">.</span>r<span class="sh_symbol">);</span>
                tu <span class="sh_symbol">=</span> s<span class="sh_symbol">.</span><span class="sh_function">range</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>r <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> ne <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
                fence<span class="sh_symbol">[</span>order<span class="sh_symbol">[</span>i_fence<span class="sh_symbol">]</span> <span class="sh_symbol">^</span> <span class="sh_number">1</span><span class="sh_symbol">].</span>d <span class="sh_symbol">=</span> <span class="sh_symbol">-</span>tu<span class="sh_symbol">;</span>
                s<span class="sh_symbol">.</span><span class="sh_function">zeroize</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l<span class="sh_symbol">,</span> F<span class="sh_symbol">.</span>r<span class="sh_symbol">);</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l <span class="sh_symbol">&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> s<span class="sh_symbol">.</span><span class="sh_function">add</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> su <span class="sh_symbol">+</span> tu<span class="sh_symbol">);</span>
                s<span class="sh_symbol">.</span><span class="sh_function">cut</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span> s<span class="sh_symbol">.</span><span class="sh_function">cut</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>r <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
            <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span> <span class="sh_comment">// disappear</span>
                s<span class="sh_symbol">.</span><span class="sh_function">zeroize</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l<span class="sh_symbol">,</span> F<span class="sh_symbol">.</span>r<span class="sh_symbol">);</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l <span class="sh_symbol">&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> s<span class="sh_symbol">.</span><span class="sh_function">add</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> F<span class="sh_symbol">.</span>d<span class="sh_symbol">);</span>
                s<span class="sh_symbol">.</span><span class="sh_function">cut</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>l<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span> s<span class="sh_symbol">.</span><span class="sh_function">cut</span><span class="sh_symbol">(</span>F<span class="sh_symbol">.</span>r <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
            <span class="sh_cbracket">}</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> i_flower <span class="sh_symbol">&lt;</span> n_flower <span class="sh_symbol">&amp;&amp;</span> flower<span class="sh_symbol">[</span>i_flower<span class="sh_symbol">].</span>c <span class="sh_symbol">==</span> sc<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i_flower<span class="sh_symbol">)</span> s<span class="sh_symbol">.</span><span class="sh_function">add</span><span class="sh_symbol">(</span>flower<span class="sh_symbol">[</span>i_flower<span class="sh_symbol">].</span>r<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span> <span class="sh_comment">// flower</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> i_cow <span class="sh_symbol">&lt;</span> n_cow <span class="sh_symbol">&amp;&amp;</span> cow<span class="sh_symbol">[</span>i_cow<span class="sh_symbol">].</span>c <span class="sh_symbol">==</span> sc<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i_cow<span class="sh_symbol">)</span><span class="sh_cbracket">{</span> <span class="sh_comment">// cow</span>
            ne <span class="sh_symbol">=</span> s<span class="sh_symbol">.</span><span class="sh_function">upper</span><span class="sh_symbol">(</span>cow<span class="sh_symbol">[</span>i_cow<span class="sh_symbol">].</span>r<span class="sh_symbol">);</span>
            ans<span class="sh_symbol">[</span>cow<span class="sh_symbol">[</span>i_cow<span class="sh_symbol">].</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> s<span class="sh_symbol">.</span><span class="sh_function">range</span><span class="sh_symbol">(</span>cow<span class="sh_symbol">[</span>i_cow<span class="sh_symbol">].</span>r<span class="sh_symbol">,</span> ne <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i_cow <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i_cow <span class="sh_symbol">&lt;</span> n_cow<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i_cow<span class="sh_symbol">)</span>
        <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> ans<span class="sh_symbol">[</span>i_cow<span class="sh_symbol">]);</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_comment">/* Hacker data:</span>
<span class="sh_comment">Input:</span>
<span class="sh_comment">2</span>
<span class="sh_comment">3 1 3 3</span>
<span class="sh_comment">5 4 5 6</span>
<span class="sh_comment">1</span>
<span class="sh_comment">7 5</span>
<span class="sh_comment">1</span>
<span class="sh_comment">1 2</span>

<span class="sh_comment">Output:</span>
<span class="sh_comment">0</span>
<span class="sh_comment">*/</span>
</code></pre></div>

<h3>坑</h3>
<p>……</p>
<p>然而……这道题的调试时间……也就是从开始写……到 AC 的时间……可能……又……打破记录了吧………………</p>
<p>……</p>
<p>发现……对拍器……半天……拍不出……代码……末尾……附加的……一个……Hack……数据………………</p>
<p>……</p>
<p>代码的……错误……部分……已经……大写……加粗了………………</p>
<p>……</p>
<p>……</p>
<p>……</p>
<p><strong>坑1：在将所有栅栏 (线段) 按照所在列从大到小排序的同时，一定，一定，一定要再把行按照第二关键字从小到大排序！！！一定要排序！！！</strong></p>
<p>比如代码末尾的这组数据：</p>
<div class="panel-body">
<h4>input:</h4>
<pre>
2
3 1 3 3
5 4 5 6
1
7 5
1
1 2
</pre>
<h4>output:</h4>
<pre>1</pre>
<h4>answer:</h4>
<pre>0</pre>
</div>
<p>如下图所示：</p>
<p><img src="uploads/2.bmp" alt="一个反例"></p>
<p>如果按所在行<strong>从大到小</strong>排序的话，由于只有一维，跑到第 $3$ 列时，会先处理下面那条闭线段，于是会将 $f_{4, 3}$ (<code>f[4]</code>) 置为 $1$，然后再处理上面这条开线段，会将 $f_{2, 3}$ (<code>f[2]</code>) 置为 $1$，导致格子 $(2, 3)$ 可以走到花，产生错误答案。当然，如果你开的是二维数组的话 <del>(不过空间不够)</del>，就不会出现这种问题。</p>
<p>如果<strong>从小到大</strong>排序的话，就会先处理上面的开线段，由于此时因为有 "下面的栅栏"，就不会更新到 $f_{2, 3}$ (<code>f[2]</code>)。</p>
<p><strong>坑2：</strong>类似地，如果同一列有栅栏、牛和花的话，应该先<strong>从上往下</strong>处理栅栏，再处理花，最后处理牛，证明类似。</p>
<p><strong>坑3：</strong>经过这次调试，顺便还能得到一个很重要的事实：<span class="very-strong"><code>std::sort</code> 不是稳定的！<code>std::sort</code> 不是稳定的！<code>std::sort</code> 不是稳定的！</span>(重要的事情说三遍)</p>
