<link type="text/css" rel="stylesheet" href="../additional_files/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/sh_typical.min.css">
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$']], displayMath: [['$$', '$$']]}});</script>
<script type="text/javascript" src="../additional_files/MathJax-master/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<h3>题目描述</h3>
<p>现有一个长度为 $n$ 的仅由 $\texttt{(}$ 和 $\texttt{)}$ 组成的字符串 $A$，你需要对给出的 $q$ 个询问 $(l, r)$，找到一个 $[l, r]$ 中尽量长的子串，使得它是括号匹配的。</p>
<p>你只要对每个询问输出最长的括号匹配的子串的长度即可。</p>

<h3>输入格式</h3>
<p>第一行包含两个正整数 $n, q$ ($n, q \leq 4 \times 10^5$)，分别表示字符串长度和询问个数。</p>
<p>第二行是一个长度为 $n$ 的仅由和 $\texttt{(}$ 和 $\texttt{)}$ 组成的字符串。</p>
<p>接下来 $m$ 行，每行包含两个整数 $l, r$，表示询问区间的左右端点，下标从 $1$ 开始。</p>

<h3>输出格式</h3>
<p>对于每个询问，输出一行一个整数，表示最长的子串的长度。</p>

<h3>题解</h3>
<p>对于括号匹配，还是按照套路地 (把 $\texttt{(}$ 看作 $1$，$\texttt{)}$ 看作 $-1$) 求个前缀和 $s_i$。那么，如果一段区间 $[l, r]$ 是匹配的，当且仅当 $s_{l-1} = s_r = \min\limits_{l-1 \leq i \leq r} s_i$。(为了方便，下文的 $l$ 对应这里的 $l-1$)</p>
<p>那么如何求最长的匹配子串呢？我们首先求出区间 $s_l, s_{l+1}, \cdots, s_r$ 中的最小值 $p$，并记 $s_u, s_v$ 为它 (在区间中) 出现的最左端和最右端的位置 (可能 $u = v$)，那么，这两个下标将区间 $[l, r]$ 分为了三段 ($[l, u), [u, v], (v, r]$)，如下图：</p>
<img class="center-block" src="uploads/21.png" alt="两个端点">
<p>首先，区间 $[u, v]$ 显然是匹配的 (由于是最小值，因此满足上面的要求)。并且可以发现，<strong>没有一段匹配的区间可以穿过两个区间</strong> (因为 $u, v$ 是最左和最右的最小值)，因此答案一定在这三段之内。显然中间一段的答案没有意义，那么只需在左右两端中更新答案即可。</p>
<p>以 $[l, u)$ 为例，对任意一个 $i \in [l, u)$，它<strong>向右所能匹配到的最远的下标</strong> $j$ 一定 $&lt; u$ (因为 $s_u &lt; s_i$)，于是，我们只需要计算出 $[l, u)$ 区间内，每个 $i$ 尽可能贪心地向右匹配，所能匹配到的最大值，$(v, r]$ 区间同理 (只是向左匹配)。</p>
<p>综上，最后更新得到的值就是答案。对于枚举 $[l, r]$ 中最小值及其出现的位置，由于不带修改，可以用 <abbr title="Sparse Table, 稀疏表">ST</abbr> 算法完成；对于两端区间的值，那么可以 $O(n)$ 预处理出每个点尽可能贪心地向右/向左匹配，所能匹配到的最大<strong>长度</strong>，也能用 <abbr title="Sparse Table, 稀疏表">ST</abbr> 算法完成 (一共需要 $4$ 个 <abbr title="Sparse Table, 稀疏表">ST</abbr> 表，当然也可以用线段树)。</p>
<p>总时间复杂度为 $O(n \log n + q)$ (<abbr title="Sparse Table, 稀疏表">ST</abbr> 表) 或 $O \left( (n + q) \log n \right)$ (线段树)。</p>

<h3>代码</h3>

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> N <span class="sh_number">512202</span>
<span class="sh_preproc">#define</span> LN <span class="sh_number">20</span>
<span class="sh_preproc">#define</span> <span class="sh_function">lg2</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_symbol">(</span><span class="sh_number">31</span> <span class="sh_symbol">-</span> <span class="sh_function">__builtin_clz</span><span class="sh_symbol">(</span>x<span class="sh_symbol">))</span>
<span class="sh_preproc">#define</span> next Next
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">typedef</span> <span class="sh_type">int</span> sparse_table<span class="sh_symbol">[</span>LN<span class="sh_symbol">][</span>N<span class="sh_symbol">];</span>

<span class="sh_type">char</span> token<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
<span class="sh_type">int</span> storage<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">],</span> <span class="sh_symbol">*</span>scx <span class="sh_symbol">=</span> storage <span class="sh_symbol">+</span> N<span class="sh_symbol">;</span>

<span class="sh_type">int</span> n<span class="sh_symbol">,</span> q<span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">,</span> k<span class="sh_symbol">;</span>
<span class="sh_type">int</span> x<span class="sh_symbol">,</span> y<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> r<span class="sh_symbol">,</span> ans<span class="sh_symbol">;</span>
<span class="sh_type">int</span> h<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> next<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> prev<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>

<span class="sh_usertype">sparse_table</span><span class="sh_normal"> </span>stl<span class="sh_symbol">,</span> str<span class="sh_symbol">,</span> stu<span class="sh_symbol">,</span> stv<span class="sh_symbol">;</span>

<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">up</span><span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>x <span class="sh_symbol">&lt;</span> y <span class="sh_symbol">?</span> x <span class="sh_symbol">=</span> y <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">int</span> <span class="sh_function">max</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">int</span> x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> x <span class="sh_symbol">&lt;</span> y <span class="sh_symbol">?</span> y <span class="sh_symbol">:</span> x<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">int</span> <span class="sh_function">hmin</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">int</span> x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> h<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;=</span> h<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">?</span> x <span class="sh_symbol">:</span> y<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">init</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>l <span class="sh_symbol">=</span> stl<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> <span class="sh_symbol">*</span>r <span class="sh_symbol">=</span> str<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> <span class="sh_symbol">*</span>u <span class="sh_symbol">=</span> stu<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> <span class="sh_symbol">*</span>v <span class="sh_symbol">=</span> stv<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">];</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> h<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> h<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(</span>token<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> <span class="sh_number">40</span> <span class="sh_symbol">?</span> <span class="sh_number">1</span> <span class="sh_symbol">:</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> l<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> r<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span>
    <span class="sh_function">memset</span><span class="sh_symbol">(</span>next<span class="sh_symbol">,</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> next<span class="sh_symbol">);</span>
    <span class="sh_function">memset</span><span class="sh_symbol">(</span>prev<span class="sh_symbol">,</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> prev<span class="sh_symbol">);</span>
    <span class="sh_function">memset</span><span class="sh_symbol">(</span>storage<span class="sh_symbol">,</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> storage<span class="sh_symbol">);</span>
    scx<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>h<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;</span> h<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">])</span> scx<span class="sh_symbol">[</span>h<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(~</span>scx<span class="sh_symbol">[</span>h<span class="sh_symbol">[</span>i<span class="sh_symbol">]])</span> next<span class="sh_symbol">[</span>prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> scx<span class="sh_symbol">[</span>h<span class="sh_symbol">[</span>i<span class="sh_symbol">]]]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span>
        scx<span class="sh_symbol">[</span>h<span class="sh_symbol">[</span>i<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> n<span class="sh_symbol">;</span> i <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(~</span>next<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&amp;&amp;</span> <span class="sh_symbol">~</span>next<span class="sh_symbol">[</span>next<span class="sh_symbol">[</span>i<span class="sh_symbol">]])</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>next<span class="sh_symbol">[</span>i<span class="sh_symbol">]];</span>
        u<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(~</span>next<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">?</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> i <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(~</span>prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&amp;&amp;</span> <span class="sh_symbol">~</span>prev<span class="sh_symbol">[</span>prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]])</span> prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> prev<span class="sh_symbol">[</span>prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]];</span>
        v<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(~</span>prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">?</span> i <span class="sh_symbol">-</span> prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">build_st_table</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">,</span> k <span class="sh_symbol">=</span> n<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>fl<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>fr<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>fu<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>fv<span class="sh_symbol">;</span>
    <span class="sh_type">int</span> <span class="sh_symbol">*</span>gl <span class="sh_symbol">=</span> stl<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> <span class="sh_symbol">*</span>gr <span class="sh_symbol">=</span> str<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> <span class="sh_symbol">*</span>gu <span class="sh_symbol">=</span> stu<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> <span class="sh_symbol">*</span>gv <span class="sh_symbol">=</span> stv<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">];</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> j <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;=</span> n <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_symbol">++</span>j<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        fl <span class="sh_symbol">=</span> gl<span class="sh_symbol">;</span> gl <span class="sh_symbol">=</span> stl<span class="sh_symbol">[</span>j <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span> fr <span class="sh_symbol">=</span> gr<span class="sh_symbol">;</span> gr <span class="sh_symbol">=</span> str<span class="sh_symbol">[</span>j <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
        fu <span class="sh_symbol">=</span> gu<span class="sh_symbol">;</span> gu <span class="sh_symbol">=</span> stu<span class="sh_symbol">[</span>j <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span> fv <span class="sh_symbol">=</span> gv<span class="sh_symbol">;</span> gv <span class="sh_symbol">=</span> stv<span class="sh_symbol">[</span>j <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
        k <span class="sh_symbol">-=</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> j<span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> k<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            gl<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">hmin</span><span class="sh_symbol">(</span>fl<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> fl<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_symbol">(</span><span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> j<span class="sh_symbol">)]);</span>
            gr<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">hmin</span><span class="sh_symbol">(</span>fr<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_symbol">(</span><span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> j<span class="sh_symbol">)],</span> fr<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
            gu<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>fu<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> fu<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_symbol">(</span><span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> j<span class="sh_symbol">)]);</span>
            gv<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>fv<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> fv<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_symbol">(</span><span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> j<span class="sh_symbol">)]);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_keyword">inline</span> <span class="sh_type">int</span> <span class="sh_function">range</span><span class="sh_symbol">(</span><span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> <span class="sh_symbol">(*</span>st<span class="sh_symbol">)[</span>N<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> D <span class="sh_symbol">=</span> R <span class="sh_symbol">-</span> L<span class="sh_symbol">,</span> c <span class="sh_symbol">=</span> <span class="sh_function">lg2</span><span class="sh_symbol">(</span>D<span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>st<span class="sh_symbol">[</span>c<span class="sh_symbol">][</span>L<span class="sh_symbol">],</span> st<span class="sh_symbol">[</span>c<span class="sh_symbol">][</span>R <span class="sh_symbol">-</span> <span class="sh_symbol">(</span><span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> c<span class="sh_symbol">)]);</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%s"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>q<span class="sh_symbol">,</span> token<span class="sh_symbol">);</span>
    <span class="sh_function">init</span><span class="sh_symbol">();</span>
    <span class="sh_function">build_st_table</span><span class="sh_symbol">();</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> q<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>q<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>y<span class="sh_symbol">);</span>
        <span class="sh_type">int</span> D <span class="sh_symbol">=</span> <span class="sh_symbol">(++</span>y<span class="sh_symbol">)</span> <span class="sh_symbol">-</span> <span class="sh_symbol">(--</span>x<span class="sh_symbol">),</span> c <span class="sh_symbol">=</span> <span class="sh_function">lg2</span><span class="sh_symbol">(</span>D<span class="sh_symbol">);</span>
        l <span class="sh_symbol">=</span> <span class="sh_function">hmin</span><span class="sh_symbol">(</span>stl<span class="sh_symbol">[</span>c<span class="sh_symbol">][</span>x<span class="sh_symbol">],</span> stl<span class="sh_symbol">[</span>c<span class="sh_symbol">][</span>y <span class="sh_symbol">-</span> <span class="sh_symbol">(</span><span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> c<span class="sh_symbol">)]);</span>
        r <span class="sh_symbol">=</span> <span class="sh_function">hmin</span><span class="sh_symbol">(</span>str<span class="sh_symbol">[</span>c<span class="sh_symbol">][</span>y <span class="sh_symbol">-</span> <span class="sh_symbol">(</span><span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> c<span class="sh_symbol">)],</span> str<span class="sh_symbol">[</span>c<span class="sh_symbol">][</span>x<span class="sh_symbol">]);</span>
        ans <span class="sh_symbol">=</span> r <span class="sh_symbol">-</span> l<span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x <span class="sh_symbol">&lt;</span> l<span class="sh_symbol">)</span> <span class="sh_function">up</span><span class="sh_symbol">(</span>ans<span class="sh_symbol">,</span> <span class="sh_function">range</span><span class="sh_symbol">(</span>x<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> stu<span class="sh_symbol">));</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>r <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;</span> y<span class="sh_symbol">)</span> <span class="sh_function">up</span><span class="sh_symbol">(</span>ans<span class="sh_symbol">,</span> <span class="sh_function">range</span><span class="sh_symbol">(</span>r <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> y<span class="sh_symbol">,</span> stv<span class="sh_symbol">));</span>
        <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> ans<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h3>坑</h3>
<p><strong>坑1：</strong>注意使用 <abbr title="Sparse Table, 稀疏表">ST</abbr> 表的时候尽量把小的 ($\log n$ 的) 一维放前面，大的 ($n$ 的) 一维放后面，最后使用<strong>指针优化</strong>。</p>

