<link type="text/css" rel="stylesheet" href="../additional_files/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/sh_typical.min.css">
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$']], displayMath: [['$$', '$$']]}});</script>
<script type="text/javascript" src="../additional_files/MathJax-master/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<h3>题目描述</h3>
<p>小园丁 Mr. S 负责看管一片田野，田野可以看作一个二维平面。田野上有 $n$ 棵许愿树，编号 $1, 2, 3, \cdots, n$，每棵树可以看作平面上的一个点，其中第 $i$ 棵树 ($1 \leq i \leq n$) 位于坐标 $(x_i, y_i)$。任意两棵树的坐标均不相同。</p>
<p>老司机 Mr. P 从原点 $(0, 0)$ 驾车出发，进行若干轮行动。每一轮，Mr. P 首先选择任意一个满足以下条件的方向：</p>
<ol>
<li>为左、右、上、左上 $45^{\circ}$、右上 $45^{\circ}$ 五个方向之一。</li>
<li>沿此方向前进可以到达一棵他尚未许愿过的树。</li>
</ol>
<p>完成选择后，Mr. P 沿该方向直线前进，必须到达该方向上距离最近的尚未许愿的树，在树下许愿并继续下一轮行动。如果没有满足条件的方向可供选择，则停止行动。他会采取最优策略，在尽可能多的树下许愿。若最优策略不唯一，可以选择任意一种。</p>
<p>不幸的是，小园丁 Mr. S 发现由于田野土质松软，老司机 Mr. P 的小汽车在每轮行进过程中，都会在田野上留下一条车辙印，一条车辙印可看作以两棵树 (或原点和一棵树) 为端点的一条线段。</p>
<p>在 Mr. P 之后，还有很多许愿者计划驾车来田野许愿，这些许愿者都会像 Mr. P 一样任选一种最优策略行动。Mr. S 认为非左右方向 (即上、左上 $45^{\circ}$、右上 $45^{\circ}$ 三个方向) 的车辙印很不美观，为了维护田野的形象，他打算租用一些轧路机，在这群许愿者到来之前夯实所有 "可能留下非左右方向车辙印" 的地面。</p>
<p>"可能留下非左右方向车辙印" 的地面应当是田野上的若干条线段，其中每条线段都包含在某一种最优策略的行进路线中。每台轧路机都采取满足以下三个条件的工作模式：</p>
<ol><li>从原点或任意一棵树出发。</li>
<li>只能向上、左上 $45^{\circ}$、右上 $45^{\circ}$ 三个方向之一移动，并且只能在树下改变方向或停止。</li>
<li>只能经过 "可能留下非左右方向车辙印" 的地面，但是同一块地面可以被多台轧路机经过。</li>
</ol><p>现在 Mr. P 和 Mr. S 分别向你提出了一个问题:</p>
<ol>
<li>请给 Mr .P 指出任意一条最优路线。</li>
<li>请告诉 Mr. S 最少需要租用多少台轧路机。</li>
</ol>

<h3>输入格式</h3>
<p>第一行包含一个正整数 $n$ ($1 \leq n \leq 5 \times 10^4$)，表示许愿树的数量。</p>
<p>接下来 $n$ 行，第 $i + 1$ ($ 1 \leq i \leq n$) 行包含两个整数 $x_i, y_i$，中间用单个空格隔开，表示第 $i$ 棵许愿树的坐标。</p>

<h3>输出格式</h3>
<p>输出共三行。</p>
<p>第一行输出一个整数 $m$，表示 Mr. P 最多能在多少棵树下许愿。</p>
<p>第二行输出 $m$ 个整数，相邻整数之间用单个空格隔开，表示 Mr. P 应该依次在哪些树下许愿。(任意一种均可)</p>
<p>第三行输出一个整数，表示 Mr. S 最少需要租用多少台轧路机。</p>

<h3>题解</h3>
<p>这可以说是一道代码量超大的压轴题 <del>(看看主页难度都飙到哪里去了)</del></p>
<p>现在我们把原题的三问分成 3 个 Part 来看。</p>
<h4> ---- Part 1 ---- </h4>
<p>首先，把所有的点 (许愿树) 按照 $y$ 坐标 (纵坐标) 从小到大排序，并加入一个 $0$ 号点 $(0, 0)$。</p>
<p>记 $f_i$ 为从纵坐标小于的它的点到达这个点 (即第一次到达高度 $y_i$) 所能经过的点数的最大值，$g_i$ 为去掉这个条件 (可能已经左右行驶) 后能经过的点数的最大值，依题有 $f_i \leq g_i$。</p>
<p>考虑 $f_i$ 的转移，这个还是比较轻松的，记 $h(i), md(i), ad(i)$ 为 $i$ 的正下方，右下 $45^{\circ}$，左下 $45^{\circ}$ 方向的点的集合，则</p>
<p>$$ f_i = \max_{j \in h(i) \cup md(i) \cup ad(i)} g_j + 1 $$</p>
<p>考虑 $g_i$ 的转移，这个就稍微得思考一下了，我们可以看到，假如说，第一次到达高度 $y_i$ 的点为 $j$，则最优方案一定是如下方案：</p>
<ol>
<li>若 $x_j &lt; x_i$，则先向左开到具有相同高度 $y_i$ 的最左端，再往右开到 $i$。</li>
<li>若 $x_j &gt; x_i$，则先向右开到具有相同高度 $y_i$ 的最右端，再往左开到 $i$。</li>
<li>若 $x_j = x_i$，则什么也不用做。</li>
</ol>
<p>设 $l, r$ 是满足 $y_k = y_i$ 的最小 $k$ 和最大 $k$，则这三种状态的转移如下：</p>
<p>$$ g_{i1} = \max_{l \leq j &lt; i} \left( f_j + i - l \right) = \left( \max_{l \leq j &lt; i} f_j \right) + i - l $$</p>
<p>$$ g_{i2} = f_i $$</p>
<p>$$ g_{i3} = \max_{i &lt; j \leq r} \left( f_j + r - j \right) = \left( \max_{i &lt; j \leq r} f_j \right) + r - j $$</p>
<p>最终 $g_i \gets \max \{g_{i1}, g_{i2}, g_{i3}\}$。</p>
<p>可以看出，求出 $l, r$ 之后，枚举 $j$，则只要从两个方向更新 $i$ 就行了。</p>
<p>最终答案就是 $\mathrm{ans} = \max\limits_{1 \leq i \leq n} g_i$。</p>
<h4> ---- Part 2 ---- </h4>
<p>我们可以任取一个 $g_i = \mathrm{ans}$ 的 $i$ (一定存在，记为<strong>有效终点</strong>)，则它一定是某条路径的终点。</p>
<p>然后枚举它同层的所有点，找出 $g_i$ 是由哪个 $f_j$ 转移过来的，然后枚举 $h(j) \cup md(j) \cup ad(j)$，找出 $f_j$ 是由哪个 $g_k$ 转移过来的，然后递归调用 $k$，直到 $k = 0$ (原点)，输出方案即可。</p>
<h4> ---- Part 3 ---- </h4>
<p>其实和第二问差不多的方法，如果点 $i$ 满足 $f_i$ 能转移到最优解，则 $F_i = 1$，否则 $F_i = 0$，类似定义 $G_i$。</p>
<p>因此对于任意一个有效终点 $i$，均有 $G_i = 1$。</p>
<p>然后对于某个 $G_i = 1$ 的 $i$，枚举它同层的所有点，找出 $g_i$ 是由<strong>哪些</strong> $f_j$ 转移过来的，把那些 $j$ 令 $F_j = 1$，可以看出 $i$ 和 $j$ 的纵坐标是相同的。</p>
<p>同理对于某个 $F_i = 1$ 的 $i$，枚举 $h(i) \cup md(i) \cup ad(i)$，找出 $f_i$ 是由<strong>哪些</strong> $g_j$ 转移过来的，把那些 $i$ 令 $G_j = 1$，<strong>并连一条从 $i$ 到 $j$ 的边 (因为 $y_i &lt; y_j$，其实 $(i, j)$ 就是从下往上 "可能留下非左右方向车辙印" 的地面)</strong>。</p>
<p>于是我们就得到了一张所有相邻的，"可能留下非左右方向车辙印" 的图 $G_0$。</p>
<p>接下来就是网络流建模：</p>
<p>建立源点 $S$ 和汇点 $T$，将 $S$ 与原图 $G_0$ 中所有的顶点连一条下界为 $0$，上界为 $+\infty$ 的边，同理将原图 $G_0$ 中所有的顶点与 $T$ 连一条下界为 $0$，上界为 $+\infty$ 的边，</p>
<p>再将原图所有的 (有向) 边设为<strong>下界为 $1$</strong> 上界为 $+\infty$ 的边，可以看出，<strong>则答案就是从 $S$ 到 $T$ 的最小流</strong>。</p>
<p>然后就用<a href="loj117;vijos %232.html" target="_blank">上一题</a>的方法跑就 OK 了。</p>

<h3>代码</h3>

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> N <span class="sh_number">170734</span>
<span class="sh_preproc">#define</span> M <span class="sh_number">2561010</span>
<span class="sh_preproc">#define</span> <span class="sh_function">ad</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_symbol">((</span>x <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">^</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">)</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">pnt</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> x<span class="sh_symbol">,</span> y<span class="sh_symbol">,</span> id<span class="sh_symbol">;</span>
    <span class="sh_function">pnt</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> x0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> y0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> id0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">):</span> <span class="sh_function">x</span><span class="sh_symbol">(</span>x0<span class="sh_symbol">),</span> <span class="sh_function">y</span><span class="sh_symbol">(</span>y0<span class="sh_symbol">),</span> <span class="sh_function">id</span><span class="sh_symbol">(</span>id0<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
    pnt <span class="sh_symbol">*</span> <span class="sh_function">read</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> id0<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>y<span class="sh_symbol">);</span> id <span class="sh_symbol">=</span> id0<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> <span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">pnt</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_keyword">const</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> y <span class="sh_symbol">&lt;</span> b<span class="sh_symbol">.</span>y <span class="sh_symbol">||</span> y <span class="sh_symbol">==</span> b<span class="sh_symbol">.</span>y <span class="sh_symbol">&amp;&amp;</span> x <span class="sh_symbol">&lt;</span> b<span class="sh_symbol">.</span>x<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">inline</span> <span class="sh_type">int</span> <span class="sh_function">mdi</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> y <span class="sh_symbol">+</span> x<span class="sh_symbol">;</span><span class="sh_cbracket">}</span> <span class="sh_keyword">inline</span> <span class="sh_type">int</span> <span class="sh_function">adi</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> y <span class="sh_symbol">-</span> x<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">edge</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> f<span class="sh_symbol">;</span>
    <span class="sh_function">edge</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> u0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> v0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> f0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">):</span> <span class="sh_function">u</span><span class="sh_symbol">(</span>u0<span class="sh_symbol">),</span> <span class="sh_function">v</span><span class="sh_symbol">(</span>v0<span class="sh_symbol">),</span> <span class="sh_function">f</span><span class="sh_symbol">(</span>f0<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_type">int</span> n<span class="sh_symbol">,</span> i<span class="sh_symbol">;</span>
<span class="sh_usertype">pnt</span><span class="sh_normal"> </span>p<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>

<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">up</span><span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>x <span class="sh_symbol">&lt;</span> y <span class="sh_symbol">?</span> x <span class="sh_symbol">=</span> y <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">down</span><span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>x <span class="sh_symbol">&gt;</span> y <span class="sh_symbol">?</span> x <span class="sh_symbol">=</span> y <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>

<span class="sh_keyword">namespace</span> Network_Flow<span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> V<span class="sh_symbol">,</span> E <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> si <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> ti <span class="sh_symbol">=</span> <span class="sh_number">2</span><span class="sh_symbol">,</span> Er<span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> tz<span class="sh_symbol">;</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> r<span class="sh_symbol">,</span> flow<span class="sh_symbol">,</span> sum <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_usertype">edge</span><span class="sh_normal"> </span>e<span class="sh_symbol">[</span>M<span class="sh_symbol">];</span>
    <span class="sh_type">int</span> first<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> next<span class="sh_symbol">[</span>M<span class="sh_symbol">];</span>
    <span class="sh_type">int</span> deg<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> dep<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> cur<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> que<span class="sh_symbol">[</span>M<span class="sh_symbol">];</span>

    <span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span><span class="sh_type">int</span> u<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">,</span> <span class="sh_type">int</span> f<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        e<span class="sh_symbol">[++</span>E<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">edge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> f<span class="sh_symbol">);</span> next<span class="sh_symbol">[</span>E<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">];</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> E<span class="sh_symbol">;</span>
        e<span class="sh_symbol">[++</span>E<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">edge</span><span class="sh_symbol">(</span>v<span class="sh_symbol">,</span> u<span class="sh_symbol">);</span> next<span class="sh_symbol">[</span>E<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>v<span class="sh_symbol">];</span> first<span class="sh_symbol">[</span>v<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> E<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">bool</span> <span class="sh_function">bfs</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
        <span class="sh_type">int</span> h<span class="sh_symbol">,</span> t <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> x<span class="sh_symbol">,</span> y<span class="sh_symbol">;</span>
        <span class="sh_function">memset</span><span class="sh_symbol">(</span>dep<span class="sh_symbol">,</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> dep<span class="sh_symbol">);</span>
        que<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> si<span class="sh_symbol">;</span> dep<span class="sh_symbol">[</span>si<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>h <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> h <span class="sh_symbol">&lt;</span> t<span class="sh_symbol">;</span> h<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">((</span>x <span class="sh_symbol">=</span> que<span class="sh_symbol">[</span>h<span class="sh_symbol">])</span> <span class="sh_symbol">==</span> ti<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_keyword">true</span><span class="sh_symbol">;</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
                y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">;</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>dep<span class="sh_symbol">[</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> <span class="sh_symbol">-</span><span class="sh_number">1</span> <span class="sh_symbol">&amp;&amp;</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>f<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
                    que<span class="sh_symbol">[</span>t<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> y<span class="sh_symbol">;</span>
                    dep<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> dep<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
                <span class="sh_cbracket">}</span>
            <span class="sh_cbracket">}</span>
        <span class="sh_cbracket">}</span>
        <span class="sh_keyword">return</span> <span class="sh_keyword">false</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">int</span> <span class="sh_function">dfs</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">,</span> <span class="sh_type">int</span> lim<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_type">int</span> a<span class="sh_symbol">,</span> c<span class="sh_symbol">,</span> f <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x <span class="sh_symbol">==</span> ti <span class="sh_symbol">||</span> <span class="sh_symbol">!</span>lim<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> lim<span class="sh_symbol">;</span>
        <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>i <span class="sh_symbol">=</span> cur<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>dep<span class="sh_symbol">[</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> dep<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">&amp;&amp;</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>f<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
                a <span class="sh_symbol">=</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>lim <span class="sh_symbol">-</span> f<span class="sh_symbol">,</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>f<span class="sh_symbol">);</span>
                c <span class="sh_symbol">=</span> <span class="sh_function">dfs</span><span class="sh_symbol">(</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">,</span> a<span class="sh_symbol">);</span>
                e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>f <span class="sh_symbol">-=</span> c<span class="sh_symbol">;</span> e<span class="sh_symbol">[</span><span class="sh_function">ad</span><span class="sh_symbol">(</span>i<span class="sh_symbol">)].</span>f <span class="sh_symbol">+=</span> c<span class="sh_symbol">;</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">((</span>f <span class="sh_symbol">+=</span> c<span class="sh_symbol">)</span> <span class="sh_symbol">==</span> lim<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> f<span class="sh_symbol">;</span>
            <span class="sh_cbracket">}</span>
        <span class="sh_keyword">return</span> f<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">Dinic</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span><span class="sh_keyword">for</span><span class="sh_symbol">(</span>flow <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_function">bfs</span><span class="sh_symbol">();</span> flow <span class="sh_symbol">+=</span> <span class="sh_function">dfs</span><span class="sh_symbol">(</span>si<span class="sh_symbol">,</span> INT_MAX<span class="sh_symbol">))</span> <span class="sh_function">memcpy</span><span class="sh_symbol">(</span>cur<span class="sh_symbol">,</span> first<span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> cur<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>

    <span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">link</span><span class="sh_symbol">(</span><span class="sh_type">int</span> u<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">,</span> <span class="sh_type">int</span> l<span class="sh_symbol">,</span> <span class="sh_type">int</span> r<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">addedge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> r <span class="sh_symbol">-</span> l<span class="sh_symbol">);</span> deg<span class="sh_symbol">[</span>v<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> l<span class="sh_symbol">;</span> deg<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">-=</span> l<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">Update</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">5</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> V <span class="sh_symbol">+</span> <span class="sh_number">2</span><span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_function">link</span><span class="sh_symbol">(</span><span class="sh_number">3</span><span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> INT_MAX<span class="sh_symbol">);</span>
            <span class="sh_function">link</span><span class="sh_symbol">(</span>i<span class="sh_symbol">,</span> <span class="sh_number">4</span><span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> INT_MAX<span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span> 
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">3</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> V <span class="sh_symbol">+</span> <span class="sh_number">2</span><span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>deg<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> <span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>sum <span class="sh_symbol">+=</span> deg<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> deg<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span><span class="sh_cbracket">}</span>
            <span class="sh_keyword">else</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>deg<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;</span> <span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span>i<span class="sh_symbol">,</span> <span class="sh_number">2</span><span class="sh_symbol">,</span> <span class="sh_symbol">-</span>deg<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_keyword">namespace</span> DP<span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> V<span class="sh_symbol">,</span> E <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> ans<span class="sh_symbol">;</span>
    <span class="sh_type">int</span> to<span class="sh_symbol">[</span>M<span class="sh_symbol">],</span> first<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> next<span class="sh_symbol">[</span>M<span class="sh_symbol">];</span>
    <span class="sh_type">int</span> ord<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> f<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> g<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> key_f<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> key_g<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
    <span class="sh_comment">// f[i]: first up to height p[i].y (transform from the tree below)</span>
    <span class="sh_comment">// g[i]: go horizontal to p[i].y (transform from the tree horizontal)</span>
    <span class="sh_keyword">inline</span> <span class="sh_type">bool</span> <span class="sh_function">Horizontal</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>A<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>B<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span>x <span class="sh_symbol">&lt;</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span>x <span class="sh_symbol">||</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span>x <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span>x <span class="sh_symbol">&amp;&amp;</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span>y <span class="sh_symbol">&lt;</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span>y<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">inline</span> <span class="sh_type">bool</span> <span class="sh_function">MainDiagonal</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>A<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>B<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span><span class="sh_function">mdi</span><span class="sh_symbol">()</span> <span class="sh_symbol">&lt;</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span><span class="sh_function">mdi</span><span class="sh_symbol">()</span> <span class="sh_symbol">||</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span><span class="sh_function">mdi</span><span class="sh_symbol">()</span> <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span><span class="sh_function">mdi</span><span class="sh_symbol">()</span> <span class="sh_symbol">&amp;&amp;</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span>y <span class="sh_symbol">&lt;</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span>y<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">inline</span> <span class="sh_type">bool</span> <span class="sh_function">AntiDiagonal</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>A<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>B<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span><span class="sh_function">adi</span><span class="sh_symbol">()</span> <span class="sh_symbol">&lt;</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span><span class="sh_function">adi</span><span class="sh_symbol">()</span> <span class="sh_symbol">||</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span><span class="sh_function">adi</span><span class="sh_symbol">()</span> <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span><span class="sh_function">adi</span><span class="sh_symbol">()</span> <span class="sh_symbol">&amp;&amp;</span> p<span class="sh_symbol">[</span>A<span class="sh_symbol">].</span>y <span class="sh_symbol">&lt;</span> p<span class="sh_symbol">[</span>B<span class="sh_symbol">].</span>y<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span><span class="sh_type">int</span> u <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> v <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>to<span class="sh_symbol">[++</span>E<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> v<span class="sh_symbol">;</span> next<span class="sh_symbol">[</span>E<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">];</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> E<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">edge_init</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
        <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> ord<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span>
        <span class="sh_function">sort</span><span class="sh_symbol">(</span>ord<span class="sh_symbol">,</span> ord <span class="sh_symbol">+</span> n<span class="sh_symbol">,</span> Horizontal<span class="sh_symbol">);</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>p<span class="sh_symbol">[</span>ord<span class="sh_symbol">[</span>i<span class="sh_symbol">]].</span>x <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>ord<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]].</span>x<span class="sh_symbol">)</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span>ord<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> ord<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]);</span>
        <span class="sh_function">sort</span><span class="sh_symbol">(</span>ord<span class="sh_symbol">,</span> ord <span class="sh_symbol">+</span> n<span class="sh_symbol">,</span> MainDiagonal<span class="sh_symbol">);</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>p<span class="sh_symbol">[</span>ord<span class="sh_symbol">[</span>i<span class="sh_symbol">]].</span><span class="sh_function">mdi</span><span class="sh_symbol">()</span> <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>ord<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]].</span><span class="sh_function">mdi</span><span class="sh_symbol">())</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span>ord<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> ord<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]);</span>
        <span class="sh_function">sort</span><span class="sh_symbol">(</span>ord<span class="sh_symbol">,</span> ord <span class="sh_symbol">+</span> n<span class="sh_symbol">,</span> AntiDiagonal<span class="sh_symbol">);</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>p<span class="sh_symbol">[</span>ord<span class="sh_symbol">[</span>i<span class="sh_symbol">]].</span><span class="sh_function">adi</span><span class="sh_symbol">()</span> <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>ord<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]].</span><span class="sh_function">adi</span><span class="sh_symbol">())</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span>ord<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> ord<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]);</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">work</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
        <span class="sh_type">int</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">,</span> k<span class="sh_symbol">,</span> e<span class="sh_symbol">,</span> t<span class="sh_symbol">;</span>
        <span class="sh_function">memset</span><span class="sh_symbol">(</span>f<span class="sh_symbol">,</span> <span class="sh_number">128</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> f<span class="sh_symbol">);</span> <span class="sh_function">memset</span><span class="sh_symbol">(</span>g<span class="sh_symbol">,</span> <span class="sh_number">128</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> g<span class="sh_symbol">);</span>
        ans <span class="sh_symbol">=</span> f<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> g<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> j<span class="sh_symbol">)</span> <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> j <span class="sh_symbol">&lt;</span> n <span class="sh_symbol">&amp;&amp;</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>y <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>j<span class="sh_symbol">].</span>y<span class="sh_symbol">;</span> j<span class="sh_symbol">++)</span>
                <span class="sh_keyword">for</span><span class="sh_symbol">(</span>e <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>j<span class="sh_symbol">];</span> e<span class="sh_symbol">;</span> e <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>e<span class="sh_symbol">])</span>
                    <span class="sh_function">up</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>j<span class="sh_symbol">],</span> g<span class="sh_symbol">[</span>to<span class="sh_symbol">[</span>e<span class="sh_symbol">]]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
            <span class="sh_function">memcpy</span><span class="sh_symbol">(</span>g <span class="sh_symbol">+</span> i<span class="sh_symbol">,</span> f <span class="sh_symbol">+</span> i<span class="sh_symbol">,</span> j <span class="sh_symbol">-</span> i <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">2</span><span class="sh_symbol">);</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>t <span class="sh_symbol">=</span> INT_MIN<span class="sh_symbol">,</span> k <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span> k <span class="sh_symbol">&lt;</span> j<span class="sh_symbol">;</span> k<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
                <span class="sh_function">up</span><span class="sh_symbol">(</span>g<span class="sh_symbol">[</span>k<span class="sh_symbol">],</span> t <span class="sh_symbol">+</span> k <span class="sh_symbol">-</span> i<span class="sh_symbol">);</span> <span class="sh_function">up</span><span class="sh_symbol">(</span>t<span class="sh_symbol">,</span> f<span class="sh_symbol">[</span>k<span class="sh_symbol">]);</span> <span class="sh_function">up</span><span class="sh_symbol">(</span>ans<span class="sh_symbol">,</span> g<span class="sh_symbol">[</span>k<span class="sh_symbol">]);</span>
            <span class="sh_cbracket">}</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>t <span class="sh_symbol">=</span> INT_MIN<span class="sh_symbol">,</span> k <span class="sh_symbol">=</span> j <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> k <span class="sh_symbol">&gt;=</span> i<span class="sh_symbol">;</span> k<span class="sh_symbol">--)</span><span class="sh_cbracket">{</span>
                <span class="sh_function">up</span><span class="sh_symbol">(</span>g<span class="sh_symbol">[</span>k<span class="sh_symbol">],</span> t <span class="sh_symbol">+</span> j <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">-</span> k<span class="sh_symbol">);</span> <span class="sh_function">up</span><span class="sh_symbol">(</span>t<span class="sh_symbol">,</span> f<span class="sh_symbol">[</span>k<span class="sh_symbol">]);</span> <span class="sh_function">up</span><span class="sh_symbol">(</span>ans<span class="sh_symbol">,</span> g<span class="sh_symbol">[</span>k<span class="sh_symbol">]);</span>
            <span class="sh_cbracket">}</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">find</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">,</span> <span class="sh_type">char</span> sep <span class="sh_symbol">=</span> <span class="sh_string">' '</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_type">int</span> l<span class="sh_symbol">,</span> r<span class="sh_symbol">,</span> y<span class="sh_symbol">,</span> i<span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>l <span class="sh_symbol">=</span> x<span class="sh_symbol">;</span> l <span class="sh_symbol">&amp;&amp;</span> p<span class="sh_symbol">[</span>l <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">].</span>y <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>x<span class="sh_symbol">].</span>y<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>l<span class="sh_symbol">);</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>r <span class="sh_symbol">=</span> x<span class="sh_symbol">;</span> r <span class="sh_symbol">&lt;</span> n <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&amp;&amp;</span> p<span class="sh_symbol">[</span>r <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">].</span>y <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>x<span class="sh_symbol">].</span>y<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>r<span class="sh_symbol">);</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> g<span class="sh_symbol">[</span>x<span class="sh_symbol">])</span> y <span class="sh_symbol">=</span> x<span class="sh_symbol">;</span>
        <span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>y <span class="sh_symbol">=</span> l<span class="sh_symbol">;</span> y <span class="sh_symbol">&lt;</span> x<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>y<span class="sh_symbol">)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> x <span class="sh_symbol">-</span> l <span class="sh_symbol">==</span> g<span class="sh_symbol">[</span>x<span class="sh_symbol">])</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>y <span class="sh_symbol">==</span> x<span class="sh_symbol">)</span> <span class="sh_keyword">for</span><span class="sh_symbol">(++</span>y<span class="sh_symbol">;</span> y <span class="sh_symbol">&lt;=</span> r<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>y<span class="sh_symbol">)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> r <span class="sh_symbol">-</span> x <span class="sh_symbol">==</span> g<span class="sh_symbol">[</span>x<span class="sh_symbol">])</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>y<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>to<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&amp;&amp;</span> f<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> g<span class="sh_symbol">[</span>to<span class="sh_symbol">[</span>i<span class="sh_symbol">]]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">find</span><span class="sh_symbol">(</span>to<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>y <span class="sh_symbol">&lt;</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> y<span class="sh_symbol">;</span> i <span class="sh_symbol">&gt;=</span> l<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span> <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d "</span><span class="sh_symbol">,</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>id<span class="sh_symbol">);</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> y <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> x<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d "</span><span class="sh_symbol">,</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>id<span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span><span class="sh_keyword">else</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>y <span class="sh_symbol">&gt;</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> y<span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> r<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d "</span><span class="sh_symbol">,</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>id<span class="sh_symbol">);</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> y <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&gt;</span> x<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span> <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d "</span><span class="sh_symbol">,</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>id<span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
        <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%c"</span><span class="sh_symbol">,</span> p<span class="sh_symbol">[</span>x<span class="sh_symbol">].</span>id<span class="sh_symbol">,</span> sep<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>

    <span class="sh_type">void</span> <span class="sh_function">search</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
        <span class="sh_type">int</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">,</span> k<span class="sh_symbol">,</span> e<span class="sh_symbol">,</span> t<span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> key_g<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>g<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> ans<span class="sh_symbol">);</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> j<span class="sh_symbol">;</span> <span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>y <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>j<span class="sh_symbol">].</span>y<span class="sh_symbol">;</span> j<span class="sh_symbol">--)</span>
                key_f<span class="sh_symbol">[</span>j<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>key_g<span class="sh_symbol">[</span>j<span class="sh_symbol">]</span> <span class="sh_symbol">&amp;&amp;</span> f<span class="sh_symbol">[</span>j<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> g<span class="sh_symbol">[</span>j<span class="sh_symbol">]);</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>t <span class="sh_symbol">=</span> INT_MAX<span class="sh_symbol">,</span> k <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span> k <span class="sh_symbol">&gt;</span> j<span class="sh_symbol">;</span> k<span class="sh_symbol">--)</span><span class="sh_cbracket">{</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>k<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;=</span> t<span class="sh_symbol">)</span> key_f<span class="sh_symbol">[</span>k<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>key_g<span class="sh_symbol">[</span>k<span class="sh_symbol">])</span> <span class="sh_function">down</span><span class="sh_symbol">(</span>t<span class="sh_symbol">,</span> g<span class="sh_symbol">[</span>k<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> k <span class="sh_symbol">+</span> j <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
            <span class="sh_cbracket">}</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>t <span class="sh_symbol">=</span> INT_MAX<span class="sh_symbol">,</span> k <span class="sh_symbol">=</span> j <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> k <span class="sh_symbol">&lt;=</span> i<span class="sh_symbol">;</span> k<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>k<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;=</span> t<span class="sh_symbol">)</span> key_f<span class="sh_symbol">[</span>k<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>key_g<span class="sh_symbol">[</span>k<span class="sh_symbol">])</span> <span class="sh_function">down</span><span class="sh_symbol">(</span>t<span class="sh_symbol">,</span> g<span class="sh_symbol">[</span>k<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> i <span class="sh_symbol">+</span> k<span class="sh_symbol">);</span>
            <span class="sh_cbracket">}</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>y <span class="sh_symbol">==</span> p<span class="sh_symbol">[</span>j<span class="sh_symbol">].</span>y<span class="sh_symbol">;</span> j<span class="sh_symbol">--)</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>key_f<span class="sh_symbol">[</span>j<span class="sh_symbol">])</span>
                    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>e <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>j<span class="sh_symbol">];</span> e<span class="sh_symbol">;</span> e <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>e<span class="sh_symbol">])</span>
                        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>j<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> g<span class="sh_symbol">[</span>to<span class="sh_symbol">[</span>e<span class="sh_symbol">]]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
                            key_g<span class="sh_symbol">[</span>to<span class="sh_symbol">[</span>e<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
                            Network_Flow<span class="sh_symbol">::</span><span class="sh_function">link</span><span class="sh_symbol">(</span>to<span class="sh_symbol">[</span>e<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">5</span><span class="sh_symbol">,</span> j <span class="sh_symbol">+</span> <span class="sh_number">5</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> INT_MAX<span class="sh_symbol">);</span>
                        <span class="sh_cbracket">}</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n<span class="sh_symbol">);</span> <span class="sh_symbol">++</span>n<span class="sh_symbol">;</span>
    p<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">pnt</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span><span class="sh_function">read</span><span class="sh_symbol">(</span>i<span class="sh_symbol">);</span>
    <span class="sh_function">sort</span><span class="sh_symbol">(</span>p<span class="sh_symbol">,</span> p <span class="sh_symbol">+</span> n<span class="sh_symbol">);</span>
    DP<span class="sh_symbol">::</span><span class="sh_function">edge_init</span><span class="sh_symbol">();</span>
    DP<span class="sh_symbol">::</span><span class="sh_function">work</span><span class="sh_symbol">();</span> 
    <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> DP<span class="sh_symbol">::</span>ans<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>DP<span class="sh_symbol">::</span>g<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> DP<span class="sh_symbol">::</span>ans<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>DP<span class="sh_symbol">::</span><span class="sh_function">find</span><span class="sh_symbol">(</span>i<span class="sh_symbol">,</span> <span class="sh_string">'</span><span class="sh_specialchar">\n</span><span class="sh_string">'</span><span class="sh_symbol">);</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    DP<span class="sh_symbol">::</span><span class="sh_function">search</span><span class="sh_symbol">();</span>
    Network_Flow<span class="sh_symbol">::</span>V <span class="sh_symbol">=</span> n <span class="sh_symbol">+</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
    Network_Flow<span class="sh_symbol">::</span><span class="sh_function">Update</span><span class="sh_symbol">();</span>
    Network_Flow<span class="sh_symbol">::</span><span class="sh_function">Dinic</span><span class="sh_symbol">();</span>
    <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> Network_Flow<span class="sh_symbol">::</span>sum <span class="sh_symbol">-</span> Network_Flow<span class="sh_symbol">::</span>flow<span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>
	
</code></pre></div>

<h3>坑</h3>
<p>可以说是 NOI 2015 代码量巨大的压轴题 <del>(其实 34.3 还不算最大，NOI 2016 是靠提答压轴，NOI 2017 的压轴题的代码量更加令人可怕)</del>。</p>
<p>写的时候，需要写 DP 和有界最小流，下面总结一些经(shen)验(keng)：</p>
<p><strong>坑1：</strong>在枚举 $h(i), md(i), ad(i)$ 三个集合的时候，千万不要 $n^2$ 枚举，<strong>不然容易 TLE 第 $7$ 个点</strong>，因为这个点是<strong>没有 <span style="color: red">"每一层的点数不超过 $1000$"</span> 的限制的！</strong>当然，可以用 <code>map &lt;int, int&gt;</code> 存储，不过时间要多一个 $\log n$，其实可以用一张图 (邻接表) 存储还是比较方便的。</p>
<p><strong>坑2：</strong>网络流的最小流通常要增广两次，顺便判断是否有解，而这个网络流是一定有解的 (因为没有上限！！！)，因此只需要一次 <code>Dinic()</code>，然后用 $\sum\limits_{u \in V} \sup(S, u)$ 减去第一次跑出来的流就是答案。</p>
<p><strong>坑3：</strong>然后发现网络流一直挂了 $7$ 个点，开始还以为数组开得太小，然后开始乱调，找边界……最终找了一个多小时居然发现是 <code>Dinic()</code> 中的 <code>dfs()</code> 调用出锅了，<strong>居然把 <code>flow += dfs(si, INT_MAX)</code> 中的 <code>flow +=</code> 漏掉了</strong>。(scx: ...)</p>
