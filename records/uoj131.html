<link type="text/css" rel="stylesheet" href="../additional_files/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/sh_typical.min.css">
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$']], displayMath: [['$$', '$$']]}});</script>
<script type="text/javascript" src="../additional_files/MathJax-master/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<h3>题目描述</h3>
<p>在大会的晚餐上，调酒师 scx 调制了 $n$ 杯鸡尾酒。这 $n$ 杯鸡尾酒排成一行，其中第 $i$ 杯酒 ($1 \leq i \leq n$) 被贴上了一个标签 $s_i$，每个标签都是 <code>a</code> ~ <code>z</code> 的小写字母之一。</p>
<p>设 $s(l, r) = s[l..r-1] = s_l s_{l+1} \cdots s_{r-1}$，若 $s(p, p + r) = s(q, q + r)$，其中 $1 \leq p \leq p + r \leq n + 1, 1 \leq q \leq q + r \leq n + 1, p \neq q$，则称第 $p$ 杯酒与第 $q$ 杯酒是 "$r$ 相似" 的。</p>
<p>当然两杯 "$r$ 相似" ($r \geq 1$) 的酒同时也是 "$0$ 相似"，"$1$ 相似"，"$2$ 相似"，…，"$(r − 1)$ 相似" 的。特别地，对于任意的 $1 \leq p \neq q \leq n$，$p \neq q$，第 $p$ 杯酒和第 $q$ 杯酒都是 "$0$ 相似" 的。</p>
<p>在品尝环节上，品酒师 ags 轻松地评定了每一杯酒的美味度，凭借其专业的水准和经验成功夺取了 "首席品酒家" 的称号，其中第 $i$ 杯酒 ($1 \leq i \leq n$) 的美味度为 $a_i$。</p>
<p>现在 scx 公布了挑战环节的问题：本次大会调制的鸡尾酒有一个特点，如果把第 $i$ 杯酒与第 $j$ 杯酒调兑在一起，将得到一杯美味度为 $a_i a_j$ 的酒。</p>
<p>现在请各位品酒师分别对于 $r = 0, 1, 2, \cdots, n − 1$，统计出有多少种方法可以选出 $2$ 杯 "$r$ 相似" 的酒，并回答选择 $2$ 杯 "$r$ 相似" 的酒调兑可以得到的美味度的最大值。</p>

<h3>输入格式</h3>
<p>第一行包含一个正整数 $n$ ($n \leq 3 \times 10^5$)，表示鸡尾酒的杯数。</p>
<p>第二行包含一个长度为 $n$ 的字符串 $s$，其中第 $i$ 个字符 $s_i$ 表示第 $i$ 杯酒的标签。</p>
<p>第三行包含 $n$ 个整数，相邻整数之间用单个空格隔开，其中第 $i$ 个整数表示第 $i$ 杯酒的美味度 $a_i$ ($|a_i| \leq 10^9$)。</p>

<h3>输出格式</h3>
<p>输出文件包括 $n$ 行，每行行输出用空格隔开的两个整数。</p>
<p>第 $i + 1$ ($0 \leq i &lt; n$) 行的第一个整数表示选出两杯 "$i$ 相似" 的酒的方案数，第二个整数表示选出两杯 "$i$ 相似" 的酒调兑可以得到的最大美味度。若不存在两杯 "$i$ 相似" 的酒，这两个数均为 $0$。</p>

<h3>题解</h3>
<p>可以看出，若酒 $p$ 和酒 $q$ 是 "$r$ 相似" 但不是 "$(r+1)$ 相似" 的充要条件是字符串 $s$ 中后缀 $p$ 和后缀 $q$ 的最长公共前缀的长度为 $r$。</p>
<p>因此，用各种五花八门的方法求出后缀数组 <code>SA[]</code> 和高度数组 <code>Height[]</code> 后，就可以知道它们的 "相似度"。</p>
<p>然而题目共有 $n$ 个子问题，如果一个一个解决的话，单次解决操作至少是 $\Omega(n)$，所以总时间复杂度至少是 $\Omega(n^2)$，显然要爆，所以要考虑 $n$ 个问题间的联系。</p>
<p>按照 <code>Height[]</code> 数组从大到小枚举，可以发现，对答案产生的贡献会越来越大。</p>
<p>考虑 <code>Height[i]</code> 为 $r$ 时，显然是包括 <code>Height[i + 1]</code> 的答案的，因此可以建立一个并查集，搜索到 <code>Height[i]</code> (即 <code>SA[i - 1]</code> 和 <code>SA[i]</code>) 时，产生的 "相似" 的对数就是当前它们所在集合的大小的乘积。</p>
<p>最大美味度就是两个集合元素乘积的最大值，最大美味度就是两个集合元素乘积的最大值，<strong>注意到有负数</strong>，所以可以使最大值的乘积，也可能是最小值的乘积。</p>
<p>然后把 <code>SA[i - 1]</code> 和 <code>SA[i]</code> 所对应的集合合并，继续操作，最终就得到答案了。</p>

<h3>代码</h3>

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> N <span class="sh_number">341468</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">typedef</span> <span class="sh_type">long</span> <span class="sh_type">long</span> ll<span class="sh_symbol">;</span>

<span class="sh_keyword">namespace</span> Suffixs<span class="sh_cbracket">{</span>
<span class="sh_preproc">    #define</span> <span class="sh_usertype">q</span><span class="sh_normal"> </span>d<span class="sh_symbol">[</span>p<span class="sh_symbol">][</span>x<span class="sh_symbol">]</span>
    <span class="sh_type">char</span> s<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
    <span class="sh_type">int</span> cnt <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> p<span class="sh_symbol">,</span> np <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">;</span>
    <span class="sh_type">int</span> pa<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">],</span> d<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">][</span><span class="sh_number">26</span><span class="sh_symbol">],</span> val<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
    <span class="sh_type">int</span> key<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">],</span> used<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">],</span> child<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">][</span><span class="sh_number">26</span><span class="sh_symbol">];</span>
    <span class="sh_type">int</span> sat <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> sa<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> rk<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> ht<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
    <span class="sh_type">void</span> <span class="sh_function">initialize</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span><span class="sh_function">memset</span><span class="sh_symbol">(</span>key<span class="sh_symbol">,</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> key<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">extend</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">,</span> <span class="sh_type">int</span> Key<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>p <span class="sh_symbol">=</span> np<span class="sh_symbol">,</span> val<span class="sh_symbol">[</span>np <span class="sh_symbol">=</span> <span class="sh_symbol">++</span>cnt<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> val<span class="sh_symbol">[</span>p<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> key<span class="sh_symbol">[</span>np<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> Key<span class="sh_symbol">;</span> p <span class="sh_symbol">&amp;&amp;</span> <span class="sh_symbol">!</span>q<span class="sh_symbol">;</span> q <span class="sh_symbol">=</span> np<span class="sh_symbol">,</span> p <span class="sh_symbol">=</span> pa<span class="sh_symbol">[</span>p<span class="sh_symbol">]);</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>p<span class="sh_symbol">)</span> pa<span class="sh_symbol">[</span>np<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">else</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>val<span class="sh_symbol">[</span>p<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">==</span> val<span class="sh_symbol">[</span>q<span class="sh_symbol">])</span> pa<span class="sh_symbol">[</span>np<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> q<span class="sh_symbol">;</span>
            <span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
                <span class="sh_type">int</span> nq <span class="sh_symbol">=</span> <span class="sh_symbol">++</span>cnt<span class="sh_symbol">;</span>
                val<span class="sh_symbol">[</span>nq<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> val<span class="sh_symbol">[</span>p<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
                <span class="sh_function">memcpy</span><span class="sh_symbol">(</span>d<span class="sh_symbol">[</span>nq<span class="sh_symbol">],</span> d<span class="sh_symbol">[</span>q<span class="sh_symbol">],</span> <span class="sh_number">104</span><span class="sh_symbol">);</span>
                pa<span class="sh_symbol">[</span>nq<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> pa<span class="sh_symbol">[</span>q<span class="sh_symbol">];</span>
                pa<span class="sh_symbol">[</span>np<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> pa<span class="sh_symbol">[</span>q<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> nq<span class="sh_symbol">;</span>
                <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> Q <span class="sh_symbol">=</span> q<span class="sh_symbol">;</span> p <span class="sh_symbol">&amp;&amp;</span> q <span class="sh_symbol">==</span> Q<span class="sh_symbol">;</span> q <span class="sh_symbol">=</span> nq<span class="sh_symbol">,</span> p <span class="sh_symbol">=</span> pa<span class="sh_symbol">[</span>p<span class="sh_symbol">]);</span>
            <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">child_init</span><span class="sh_symbol">(</span><span class="sh_type">int</span> n<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_type">int</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">,</span> pos<span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>used<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> i <span class="sh_symbol">=</span> <span class="sh_number">2</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> cnt<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(~</span>key<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
                <span class="sh_keyword">for</span><span class="sh_symbol">(</span>pos <span class="sh_symbol">=</span> n<span class="sh_symbol">,</span> j <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span> <span class="sh_symbol">!</span>used<span class="sh_symbol">[</span>j<span class="sh_symbol">];</span> j <span class="sh_symbol">=</span> pa<span class="sh_symbol">[</span>j<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
                    pos <span class="sh_symbol">+=</span> val<span class="sh_symbol">[</span>pa<span class="sh_symbol">[</span>j<span class="sh_symbol">]]</span> <span class="sh_symbol">-</span> val<span class="sh_symbol">[</span>j<span class="sh_symbol">];</span>
                    child<span class="sh_symbol">[</span>pa<span class="sh_symbol">[</span>j<span class="sh_symbol">]][</span>s<span class="sh_symbol">[</span>pos<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> <span class="sh_string">'a'</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> j<span class="sh_symbol">;</span>
                    used<span class="sh_symbol">[</span>j<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
                <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">dfs</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(~</span>key<span class="sh_symbol">[</span>x<span class="sh_symbol">])</span> sa<span class="sh_symbol">[</span>sat<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> key<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> <span class="sh_number">26</span><span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>child<span class="sh_symbol">[</span>x<span class="sh_symbol">][</span>i<span class="sh_symbol">])</span> <span class="sh_function">dfs</span><span class="sh_symbol">(</span>child<span class="sh_symbol">[</span>x<span class="sh_symbol">][</span>i<span class="sh_symbol">]);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">rank_and_height</span><span class="sh_symbol">(</span><span class="sh_type">int</span> n<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> rk<span class="sh_symbol">[</span>sa<span class="sh_symbol">[</span>i<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span>
        ht<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> p <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
            p <span class="sh_symbol">?</span> <span class="sh_symbol">--</span> p <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>rk<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span> <span class="sh_keyword">continue</span><span class="sh_symbol">;</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> sa<span class="sh_symbol">[</span>rk<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">];</span> s<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> p<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> s<span class="sh_symbol">[</span>j <span class="sh_symbol">+</span> p<span class="sh_symbol">];</span> <span class="sh_symbol">++</span>p<span class="sh_symbol">);</span>
            ht<span class="sh_symbol">[</span>rk<span class="sh_symbol">[</span>i<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> p<span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
<span class="sh_preproc">    #undef</span> q
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> n<span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">;</span>
<span class="sh_type">int</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">;</span>
<span class="sh_usertype">ll</span><span class="sh_normal"> </span>a<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> Min<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> Max<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> cnt<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> deli<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
<span class="sh_type">int</span> p<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> sz<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> ord<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>

<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">up</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>x <span class="sh_symbol">&lt;</span> y <span class="sh_symbol">?</span> x <span class="sh_symbol">=</span> y <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">down</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>x <span class="sh_symbol">&gt;</span> y <span class="sh_symbol">?</span> x <span class="sh_symbol">=</span> y <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">bool</span> <span class="sh_function">cmp</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> Suffixs<span class="sh_symbol">::</span>ht<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> Suffixs<span class="sh_symbol">::</span>ht<span class="sh_symbol">[</span>y<span class="sh_symbol">];</span><span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">ancestor</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> p<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> x <span class="sh_symbol">?</span> x <span class="sh_symbol">:</span> <span class="sh_symbol">(</span>p<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">ancestor</span><span class="sh_symbol">(</span>p<span class="sh_symbol">[</span>x<span class="sh_symbol">]));</span><span class="sh_cbracket">}</span>

<span class="sh_type">bool</span> <span class="sh_function">test</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">,</span> <span class="sh_type">int</span> y<span class="sh_symbol">,</span> <span class="sh_type">bool</span> un <span class="sh_symbol">=</span> <span class="sh_keyword">false</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">((</span>x <span class="sh_symbol">=</span> <span class="sh_function">ancestor</span><span class="sh_symbol">(</span>x<span class="sh_symbol">))</span> <span class="sh_symbol">==</span> <span class="sh_symbol">(</span>y <span class="sh_symbol">=</span> <span class="sh_function">ancestor</span><span class="sh_symbol">(</span>y<span class="sh_symbol">)))</span> <span class="sh_keyword">return</span> <span class="sh_keyword">true</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>un<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>sz<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> sz<span class="sh_symbol">[</span>y<span class="sh_symbol">])</span> <span class="sh_function">swap</span><span class="sh_symbol">(</span>x<span class="sh_symbol">,</span> y<span class="sh_symbol">);</span>
        p<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> y<span class="sh_symbol">;</span> sz<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> sz<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span>
        <span class="sh_function">up</span><span class="sh_symbol">(</span>Max<span class="sh_symbol">[</span>y<span class="sh_symbol">],</span> Max<span class="sh_symbol">[</span>x<span class="sh_symbol">]);</span> <span class="sh_function">down</span><span class="sh_symbol">(</span>Min<span class="sh_symbol">[</span>y<span class="sh_symbol">],</span> Min<span class="sh_symbol">[</span>x<span class="sh_symbol">]);</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%s"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n<span class="sh_symbol">,</span> Suffixs<span class="sh_symbol">::</span>s<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%lld"</span><span class="sh_symbol">,</span> a <span class="sh_symbol">+</span> i<span class="sh_symbol">);</span>
    Suffixs<span class="sh_symbol">::</span><span class="sh_function">initialize</span><span class="sh_symbol">();</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span> Suffixs<span class="sh_symbol">::</span><span class="sh_function">extend</span><span class="sh_symbol">(</span>Suffixs<span class="sh_symbol">::</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> <span class="sh_string">'a'</span><span class="sh_symbol">,</span> i<span class="sh_symbol">);</span>
    Suffixs<span class="sh_symbol">::</span><span class="sh_function">child_init</span><span class="sh_symbol">(</span>n<span class="sh_symbol">);</span>
    Suffixs<span class="sh_symbol">::</span><span class="sh_function">dfs</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">);</span>
    Suffixs<span class="sh_symbol">::</span><span class="sh_function">rank_and_height</span><span class="sh_symbol">(</span>n<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
        ord<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span> sz<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
        Max<span class="sh_symbol">[</span>Suffixs<span class="sh_symbol">::</span>rk<span class="sh_symbol">[</span>i<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> Min<span class="sh_symbol">[</span>Suffixs<span class="sh_symbol">::</span>rk<span class="sh_symbol">[</span>i<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> a<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_function">sort</span><span class="sh_symbol">(</span>ord <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> ord <span class="sh_symbol">+</span> n<span class="sh_symbol">,</span> cmp<span class="sh_symbol">);</span>
    i <span class="sh_symbol">=</span> Suffixs<span class="sh_symbol">::</span>ht<span class="sh_symbol">[</span>ord<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]];</span>
    cnt<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> deli<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> LLONG_MIN<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_symbol">~</span>i<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        cnt<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> cnt<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span> deli<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> deli<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> j <span class="sh_symbol">&lt;</span> n <span class="sh_symbol">&amp;&amp;</span> Suffixs<span class="sh_symbol">::</span>ht<span class="sh_symbol">[</span>ord<span class="sh_symbol">[</span>j<span class="sh_symbol">]]</span> <span class="sh_symbol">==</span> i<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>j<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            u <span class="sh_symbol">=</span> <span class="sh_function">ancestor</span><span class="sh_symbol">(</span>ord<span class="sh_symbol">[</span>j<span class="sh_symbol">]);</span> v <span class="sh_symbol">=</span> <span class="sh_function">ancestor</span><span class="sh_symbol">(</span>ord<span class="sh_symbol">[</span>j<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
            cnt<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> <span class="sh_symbol">(</span>ll<span class="sh_symbol">)</span>sz<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">*</span> sz<span class="sh_symbol">[</span>v<span class="sh_symbol">];</span>
            <span class="sh_function">up</span><span class="sh_symbol">(</span>deli<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> Max<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">*</span> Max<span class="sh_symbol">[</span>v<span class="sh_symbol">]);</span>
            <span class="sh_function">up</span><span class="sh_symbol">(</span>deli<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> Min<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">*</span> Min<span class="sh_symbol">[</span>v<span class="sh_symbol">]);</span>
            <span class="sh_function">test</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> <span class="sh_keyword">true</span><span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
        <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%lld %lld</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> cnt<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> cnt<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">?</span> deli<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h3>坑</h3>
<p><b>坑1：</b>已经提到过了，因为 $a_i$ 可能是负数，所以<strong>必须维护最小值</strong>，它们的乘积也要考虑。<del>(搞不明白两杯美味度差的就调兑在一起美味度就变成正的了，可能是起化学反应了吧)</del></p>
<p><b>坑2：</b>像样例二，最大美味度<strong>可能是负值</strong>，因此初始的 <code>deli[]</code> 数组要设置成 <code>LLONG_MIN</code> 或绝对值很大很大的负数，因为答案的绝对值也可能很大，<strong>并且如果不存在方案，不能输出那个 <code>LLONG_MIN</code>，要输出 <code>0</code></strong>。</p>
<p><strong>坑3：最重要又是最基本的，后缀自动机空间 $\times 2$！！！！不然肯定要 RE！！！！</strong></p>
